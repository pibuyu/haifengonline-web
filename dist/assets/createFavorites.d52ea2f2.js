import{L as I,k as T,r as S,s as m,S as i,H as f,d as x,o as V,a_ as k,a as E,c as U,g as p,b as d,w as _,u as t,f as C,aG as q,i as M,G as j,t as L,a0 as N,aI as z,I as G,av as H,aw as O,J as P,C as J,D as $,l as K}from"./index.0228ac47.js";/* empty css                  *//* empty css                     *//* empty css                 */import"./aliyun-oss-sdk.c5af02fd.js";/* empty css                */import{v as Q}from"./focus.de63bc5a.js";import{g as W}from"./commonality.2a0df1e0.js";import{j as X}from"./personal.ec4b42a6.js";import{u as Y}from"./upload.8470b696.js";import{h as Z}from"./validate.c9820062.js";/* empty css                                                                        */const R=()=>{const e=I(),a=T(),u=S(),o=m({id:0,FileUrl:"",uploadUrl:"",interface:"createFavoritesCover",title:"",content:"",uploadType:"",action:"#",progress:0}),n=m({title:"",img:""});return{userStore:e,createFavoriteRmationForm:o,saveDateFormRef:u,rawData:n,router:a}},ee=e=>({handleFileSuccess:(s,l)=>{e.FileUrl=URL.createObjectURL(l.raw)},beforeFileUpload:async s=>await new Promise((l,r)=>{s.size/1024/1024>2&&(i.fire({title:"\u5C01\u9762\u5927\u5C0F\u4E0D\u80FD\u5927\u4E8E2M",heightAuto:!1,icon:"error"}),r(!1));let g=new FileReader;g.readAsDataURL(s),g.onload=()=>{let c=new Image;c.src=g.result,c.onload=()=>{console.log(c.width),console.log(c.height),c.width<960||c.height<600?(i.fire({title:"\u8BF7\u4E0A\u4F20 960*600 \u5C3A\u5BF8\u4EE5\u4E0A\u56FE\u7247",heightAuto:!1,confirmButtonColor:f.colorButtonTheme,icon:"error"}),r(!1)):l(!0)}}}),handleFileError:s=>{console.log("\u4E0A\u4F20\u5931\u8D25"),i.fire({title:"\u4E0A\u4F20\u5931\u8D25",heightAuto:!1,confirmButtonColor:f.colorButtonTheme,icon:"error"}),console.log(s)},RedefineUploadFile:async s=>{try{const l=await Y(e,s.file);console.log(l),e.uploadUrl=l==null?void 0:l.path,console.log(l)}catch(l){console.log(l),i.fire({title:"\u83B7\u53D6\u4E0A\u4F20\u8282\u70B9\u5931\u8D25",heightAuto:!1,confirmButtonColor:f.colorButtonTheme,icon:"error"})}}}),oe=async(e,a,u,o,n)=>{!a||await a.validate(async(s,l)=>{if(s)try{if(e.uploadUrl==u.img&&e.title==u.title)throw"\u672A\u4FEE\u6539\u4FE1\u606F";if(!e.uploadUrl)throw"\u8BF7\u5148\u4E0A\u4F20\u56FE\u7247";const r={id:e.id,type:e.uploadType,cover:e.uploadUrl,title:e.title,content:e.content};await X(r),n("shutDown"),e.id==0?(e.FileUrl="",e.title="",e.content="",i.fire({title:"\u521B\u5EFA\u6210\u529F",confirmButtonColor:f.colorButtonTheme,heightAuto:!1,icon:"success",preConfirm:()=>{o.push({name:"Favorites",query:{type:"createTime"+Date.now()}})}})):i.fire({title:"\u66F4\u65B0\u6210\u529F",confirmButtonColor:f.colorButtonTheme,heightAuto:!1,icon:"success"})}catch(r){console.log(r),n("shutDown"),i.fire({title:r.message,confirmButtonColor:f.colorButtonTheme,heightAuto:!1,icon:"warning"})}else console.log("error submit!",l)})},D=async(e,a,u,o)=>{try{const n=(await W({method:e.interface})).data;if(e.uploadType=n.type,!u){if(o==null)return!1;e.FileUrl&&(e.uploadType=o.type),e.title=o.title,e.content=o.content,e.uploadUrl=o.src,e.FileUrl=o.cover,e.id=o.id}}catch(n){console.log(n),i.fire({title:"\u83B7\u53D6\u4E0A\u4F20\u65B9\u6CD5\u5931\u8D25",heightAuto:!1,confirmButtonColor:f.colorButtonTheme,icon:"error"})}},te=()=>({liveInformationRules:m({title:[{validator:Z,trigger:"change"}]})}),le=e=>(J("data-v-ab531590"),e=e(),$(),e),se={class:"overall"},ue={class:"principal personal-layout"},ne={class:"form-box"},re=["src"],ae={class:"form-show"},ie={class:"bottom-box"},ce=le(()=>p("span",{class:"text"}," \u8BF7\u8BBE\u7F6E\u60A8\u7684\u5C01\u9762\u548C\u6807\u9898,\u4EE5\u4FBF\u66F4\u597D\u67E5\u8BE2\u6536\u85CF\u5185\u5BB9\u55F7~ ",-1)),de={class:"button"},pe=x({__name:"createFavorites",props:{info:{type:Object},type:{type:Boolean,required:!0}},emits:["shutDown"],setup(e,{emit:a}){const u=e,{createFavoriteRmationForm:o,saveDateFormRef:n,rawData:s,router:l}=R(),r=ee(o),{liveInformationRules:g}=te();return V(()=>{D(o,s,u.type,u.info)}),k(()=>{D(o,s,u.type,u.info)}),(c,h)=>{const F=N,b=z,y=G,w=H,v=O,A=P;return E(),U("div",se,[p("div",ue,[p("div",ne,[d(b,{class:"cover-uploader",action:t(o).action,"show-file-list":!1,"on-success":t(r).handleFileSuccess,"on-error":t(r).handleFileError,"before-upload":t(r).beforeFileUpload,"auto-upload":!0,"http-request":t(r).RedefineUploadFile,accept:".png,.jpg,.jpeg"},{default:_(()=>[t(o).FileUrl?(E(),U("img",{key:0,src:t(o).FileUrl,class:"cover"},null,8,re)):(E(),C(F,{key:1,class:"cover-uploader-icon"},{default:_(()=>[d(t(q))]),_:1}))]),_:1},8,["action","on-success","on-error","before-upload","http-request"]),p("div",null,[p("div",ae,[d(v,{model:t(o),ref_key:"saveDateFormRef",ref:n,rules:t(g),"label-position":"left","label-width":"5rem"},{default:_(()=>[d(w,{label:"\u6807\u9898",prop:"title"},{default:_(()=>[d(y,{modelValue:t(o).title,"onUpdate:modelValue":h[0]||(h[0]=B=>t(o).title=B)},null,8,["modelValue"])]),_:1}),d(w,{label:"\u4ECB\u7ECD"},{default:_(()=>[d(y,{type:"textarea",resize:"none",rows:4,modelValue:t(o).content,"onUpdate:modelValue":h[1]||(h[1]=B=>t(o).content=B)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])])]),p("div",ie,[ce,p("div",de,[M((E(),C(A,{onClick:h[2]||(h[2]=B=>t(oe)(t(o),t(n),t(s),t(l),a)),type:"primary",round:""},{default:_(()=>[j(L(t(o).id==0?"\u521B\u5EFA\u6587\u4EF6\u5939":"\u66F4\u65B0\u6587\u4EF6\u5939"),1)]),_:1})),[[t(Q)]])])])])])}}}),Fe=K(pe,[["__scopeId","data-v-ab531590"]]);export{Fe as C};
