import{d as Ne,r as xe,o as Ye,a as ie,c as se,g as W,F as Fe,e as Be,q as qe,b as Y,G as $e,t as de,u as ee,X as mt,w as ve,k as rt,_ as nt,C as Xe,D as Qe,l as We,i as be,aX as vt,aY as gt,aZ as xt,U as it,J as st,s as we,B as et,v as Et,T as yt,aa as St,I as Lt,aS as At,aT as Rt,S as ke,H as Ue,aj as bt,am as Ot,L as Ct,N as Tt,aU as Dt,ac as It,ad as wt}from"./index.0228ac47.js";/* empty css               *//* empty css               */import{o as Mt}from"./contribution.36ea1e3c.js";import{y as Pt}from"./vue-ellipsis-3.es.74e51318.js";/* empty css                  *//* empty css                  */import{v as Me}from"./focus.de63bc5a.js";/* empty css                    *//* empty css                 */import{b as Ft}from"./live.facdac17.js";import{D as Bt}from"./DPlayer.min.b7c897e2.js";import"./index.f22c08f3.js";const kt=g=>(Xe("data-v-539fb2d0"),g=g(),Qe(),g),Ut={class:"column"},jt={class:"column-list"},Nt=["onMouseover","onMouseleave","onClick"],Wt=["src"],Gt={class:"item-text"},Kt={class:"post-meta"},Vt={class:"post-meta",style:{"margin-bottom":"15px"}},Ht={class:"recent-post-desc"},zt=kt(()=>W("span",null,"...",-1)),$t={class:"sort-label"},Yt=Ne({__name:"column",props:{roomID:{type:Number,required:!0}},setup(g){const R=g,D=rt(),F=xe([]),P=_=>{_.is_stay=!0},k=_=>{_.is_stay=!1},O=async()=>{var _;try{console.log(R);let x={userID:R.roomID};const h=await Mt(x);(_=h.data)==null||_.filter(o=>(o.is_stay=!1,!0)),F.value=h.data,console.log(h)}catch(x){console.log(x)}},v=_=>{D.push({name:"ArticleShow",params:{id:_}})};return Ye(()=>{O()}),(_,x)=>{const h=nt;return ie(),se("div",Ut,[W("div",jt,[(ie(!0),se(Fe,null,Be(F.value,(o,i)=>(ie(),se("div",{class:qe([{mouseover:o.is_stay,mouseleave:!o.is_stay},"column-item shadow-box"]),onMouseover:d=>P(o),onMouseleave:d=>k(o),key:o.id,onClick:d=>v(o.id)},[W("div",{class:qe({"item-image":!0,right:i%2==1})},[W("img",{src:o.cover,class:"el-image__inner image",style:{"object-fit":"cover"}},null,8,Wt)],2),W("div",Gt,[W("div",Kt,[Y(h,{name:"camera",class:"icon-small"}),$e(' " \u53D1\u5E03\u4E8E '+de(ee(mt)(o.created_at).format("YYYY.MM.DD.hh.mm"))+' " ',1)]),W("h3",null,de(o.title),1),W("div",Vt,[Y(h,{name:"hot",class:"icon-small"}),W("span",null,de(o.heat)+" \u70ED\u5EA6 ",1),Y(h,{name:"comments",class:"icon-small"}),W("span",null,de(o.comments_number)+" \u6761\u8BC4\u8BBA ",1),Y(h,{name:"like",class:"icon-small"}),W("span",null,de(o.likes_number)+"\u70B9\u8D5E ",1)]),W("div",Ht,[Y(ee(Pt),{text:o.content,visibleLine:4},{ellipsisNode:ve(()=>[zt]),_:2},1032,["text"])]),W("div",$t,[(ie(!0),se(Fe,null,Be(o.label,d=>(ie(),se("span",{class:"lable-item",style:{"margin-right":"12px"},key:d},[Y(h,{name:"label",class:"icon-small"}),$e(" "+de(d),1)]))),128))])])],42,Nt))),128))])])}}});const Xt=We(Yt,[["__scopeId","data-v-539fb2d0"]]),Qt={class:"live-info"},Zt={class:"avatar"},Jt={class:"info"},qt={class:"info-left"},er={class:"live-titel"},tr={class:"info-right"},rr=Ne({__name:"liveHeader",props:{src:{type:String,required:!0},titel:{type:String,required:!0}},setup(g){return(R,D)=>{const F=it,P=st;return ie(),se("div",Qt,[W("div",Zt,[Y(F,{size:38,src:g.src},null,8,["src"])]),W("div",Jt,[W("div",qt,[W("p",er,de(g.titel),1)]),W("div",tr,[be(Y(P,{type:"primary",icon:ee(vt),circle:""},null,8,["icon"]),[[ee(Me)]]),be(Y(P,{type:"primary",icon:ee(gt),circle:""},null,8,["icon"]),[[ee(Me)]]),be(Y(P,{type:"primary",icon:ee(xt),circle:""},null,8,["icon"]),[[ee(Me)]])])])])}}});const nr=We(rr,[["__scopeId","data-v-6e8b67fe"]]);function ir(g){let R=ut();return sr(g,R),dt(R)}function sr(g,R){let D=g.msgType;D!==void 0&&(ye(R,10),Pe(R,D));let F=g.data;F!==void 0&&(ye(R,18),ye(R,F.length),xr(R,F))}function or(g){return ar(Ge(g))}function ar(g){let R={};e:for(;!Ce(g);){let D=te(g);switch(D>>>3){case 0:break e;case 1:{R.msgType=_e(g,te(g));break}case 2:{R.data=gr(g,te(g));break}default:Oe(g,D&7)}}return R}function lr(g){let R=ut();return ur(g,R),dt(R)}function ur(g,R){let D=g.text;D!==void 0&&(ye(R,10),Pe(R,D));let F=g.color;F!==void 0&&(ye(R,18),Pe(R,F));let P=g.type;P!==void 0&&(ye(R,26),Pe(R,P))}function dr(g){return ot(Ge(g))}function ot(g){let R={};e:for(;!Ce(g);){let D=te(g);switch(D>>>3){case 0:break e;case 1:{R.msg_id=je(g);break}case 2:{R.user_id=je(g);break}case 3:{R.username=_e(g,te(g));break}case 4:{R.avatar=_e(g,te(g));break}case 5:{R.text=_e(g,te(g));break}case 6:{R.color=_e(g,te(g));break}case 7:{R.type=_e(g,te(g));break}default:Oe(g,D&7)}}return R}function fr(g){return hr(Ge(g))}function hr(g){let R={};e:for(;!Ce(g);){let D=te(g);switch(D>>>3){case 0:break e;case 1:{let F=at(g);(R.list||(R.list=[])).push(ot(g)),g.limit=F;break}default:Oe(g,D&7)}}return R}function cr(g){let R={};e:for(;!Ce(g);){let D=te(g);switch(D>>>3){case 0:break e;case 1:{R.user_id=je(g);break}case 2:{R.username=_e(g,te(g));break}case 3:{R.avatar=_e(g,te(g));break}default:Oe(g,D&7)}}return R}function _r(g){return pr(Ge(g))}function pr(g){let R={};e:for(;!Ce(g);){let D=te(g);switch(D>>>3){case 0:break e;case 1:{R.user_id=je(g);break}case 2:{R.username=_e(g,te(g));break}case 3:{R.avatar=_e(g,te(g));break}case 4:{R.type=!!Je(g);break}case 5:{let F=at(g);(R.list||(R.list=[])).push(cr(g)),g.limit=F;break}default:Oe(g,D&7)}}return R}function at(g){let R=te(g),D=g.limit;return g.limit=g.offset+R,D}function Oe(g,R){switch(R){case 0:for(;Je(g)&128;);break;case 2:ze(g,te(g));break;case 5:ze(g,4);break;case 1:ze(g,8);break;default:throw new Error("Unimplemented type: "+R)}}let lt=new Float32Array(1),Ie=new Uint8Array(lt.buffer),mr=new Float64Array(1);new Uint8Array(mr.buffer);let vr=[];function ut(){const g=vr.pop();return g?(g.offset=g.limit=0,g):{bytes:new Uint8Array(64),offset:0,limit:0}}function Ge(g){return{bytes:g,offset:0,limit:g.length}}function dt(g){let R=g.bytes,D=g.limit;return R.length===D?R:R.subarray(0,D)}function ze(g,R){if(g.offset+R>g.limit)throw new Error("Skip past limit");g.offset+=R}function Ce(g){return g.offset>=g.limit}function Ze(g,R){let D=g.bytes,F=g.offset,P=g.limit,k=F+R;if(k>D.length){let O=new Uint8Array(k*2);O.set(D),g.bytes=O}return g.offset=k,k>P&&(g.limit=k),F}function Ke(g,R){let D=g.offset;if(D+R>g.limit)throw new Error("Read past limit");return g.offset+=R,D}function gr(g,R){let D=Ke(g,R);return g.bytes.subarray(D,D+R)}function xr(g,R){let D=Ze(g,R.length);g.bytes.set(R,D)}function _e(g,R){let D=Ke(g,R),F=String.fromCharCode,P=g.bytes,k="\uFFFD",O="";for(let v=0;v<R;v++){let _=P[v+D],x,h,o,i;(_&128)===0?O+=F(_):(_&224)===192?v+1>=R?O+=k:(x=P[v+D+1],(x&192)!==128?O+=k:(i=(_&31)<<6|x&63,i<128?O+=k:(O+=F(i),v++))):(_&240)==224?v+2>=R?O+=k:(x=P[v+D+1],h=P[v+D+2],((x|h<<8)&49344)!==32896?O+=k:(i=(_&15)<<12|(x&63)<<6|h&63,i<2048||i>=55296&&i<=57343?O+=k:(O+=F(i),v+=2))):(_&248)==240?v+3>=R?O+=k:(x=P[v+D+1],h=P[v+D+2],o=P[v+D+3],((x|h<<8|o<<16)&12632256)!==8421504?O+=k:(i=(_&7)<<18|(x&63)<<12|(h&63)<<6|o&63,i<65536||i>1114111?O+=k:(i-=65536,O+=F((i>>10)+55296,(i&1023)+56320),v+=3))):O+=k}return O}function Pe(g,R){let D=R.length,F=0;for(let O=0;O<D;O++){let v=R.charCodeAt(O);v>=55296&&v<=56319&&O+1<D&&(v=(v<<10)+R.charCodeAt(++O)-56613888),F+=v<128?1:v<2048?2:v<65536?3:4}ye(g,F);let P=Ze(g,F),k=g.bytes;for(let O=0;O<D;O++){let v=R.charCodeAt(O);v>=55296&&v<=56319&&O+1<D&&(v=(v<<10)+R.charCodeAt(++O)-56613888),v<128?k[P++]=v:(v<2048?k[P++]=v>>6&31|192:(v<65536?k[P++]=v>>12&15|224:(k[P++]=v>>18&7|240,k[P++]=v>>12&63|128),k[P++]=v>>6&63|128),k[P++]=v&63|128)}}function Je(g){return g.bytes[Ke(g,1)]}function tt(g,R){let D=Ze(g,1);g.bytes[D]=R}function je(g){let R=Ke(g,4),D=g.bytes;return Ie[0]=D[R++],Ie[1]=D[R++],Ie[2]=D[R++],Ie[3]=D[R++],lt[0]}function te(g){let R=0,D=0,F;do F=Je(g),R<32&&(D|=(F&127)<<R),R+=7;while(F&128);return D}function ye(g,R){for(R>>>=0;R>=128;)tt(g,R&127|128),R>>>=7;tt(g,R)}const Er=(g,R)=>ir({msgType:g,data:R}),yr=g=>(Xe("data-v-28543027"),g=g(),Qe(),g),Sr={class:"left-box",width:"200px"},Lr={class:"barrage-msg-list"},Ar={key:0,class:"barrage-msg-left"},Rr={class:"msg-text"},br={class:"msg-span"},Or={key:1,class:"barrage-msg-right"},Cr={class:"msg-text"},Tr={class:"msg-span"},Dr=yr(()=>W("div",null,null,-1)),Ir={class:"prompt"},wr={class:"barrage-send"},Mr={class:"online"},Pr={class:"online-list"},Fr={class:"online-info"},Br={class:"username"},kr=Ne({__name:"side",props:{userInfo:Object},emits:["sendMessage"],setup(g,{expose:R,emit:D}){const F=xe("first"),P=xe(),k=we({scrollHeight:0,windowHeight:0,scrollTop:0,offsetHeight:0}),O=we({show:!1,num:0}),v=we({baeeage:[],online:[]}),_=xe(""),x=(d,r)=>{console.log(d,r)},h=()=>{if(!_.value){St.success({title:"Warning",message:"",offset:70});return}const d=Er("webClientBarrageReq",lr({text:_.value,color:"#fff",type:"right"}));_.value="",D("sendMessage",d),o()},o=()=>{P.value.scrollTop=P.value.scrollHeight,O.show=!1,O.num=0},i=()=>{k.scrollHeight=P.value.scrollHeight,k.windowHeight=P.value.clientHeight,k.scrollTop=P.value.scrollTop,k.offsetHeight=P.value.offsetHeight,k.windowHeight+k.scrollTop<k.scrollHeight&&(O.show=!1,O.num=0)};return R({addBarrage(d){k.windowHeight+k.scrollTop<k.scrollHeight?(v.baeeage=[...v.baeeage,d],O.show=!0,O.num++):(v.baeeage=[...v.baeeage,d],setTimeout(()=>{P.value.scrollTop=P.value.scrollHeight},100))},async addHistoryBarrage(d){if(!d.list)return!1;v.baeeage=[...v.baeeage,...d.list.reverse()]},updataOnline(d){v.online=d}}),Ye(()=>{}),(d,r)=>{const l=it,u=nt,n=Lt,t=st,a=At,s=Rt;return ie(),se("div",Sr,[Y(s,{modelValue:F.value,"onUpdate:modelValue":r[1]||(r[1]=e=>F.value=e),stretch:"",class:"demo-tabs",onTabClick:x},{default:ve(()=>[Y(a,{label:"\u5B9E\u65F6\u5F39\u5E55",name:"first"},{default:ve(()=>[W("div",{class:"barrage",onScroll:i,ref_key:"barrageMsgListRef",ref:P},[W("div",null,[W("div",Lr,[(ie(!0),se(Fe,null,Be(ee(v).baeeage,e=>{var f,c;return ie(),se("div",{key:e.msg_id},[((f=g.userInfo)==null?void 0:f.id)!=e.user_id?(ie(),se("div",Ar,[Y(l,{shape:"circle",size:34,src:e.avatar},null,8,["src"]),W("div",Rr,[W("span",br,de(e.text),1)])])):et("",!0),((c=g.userInfo)==null?void 0:c.id)==e.user_id?(ie(),se("div",Or,[W("div",Cr,[W("span",Tr,de(e.text),1)]),Y(l,{shape:"circle",size:34,src:e.avatar},null,8,["src"])])):et("",!0),Dr])}),128))])]),be(W("div",{class:"barrage-prompt",onClick:o},[W("div",Ir,[$e(" \u65B0\u5F39\u5E55\u6765\u8FBD "+de(O.num)+" ",1),Y(u,{name:"drop-down",class:"icon"})])],512),[[Et,O.show]]),W("div",wr,[Y(n,{modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=e=>_.value=e),resize:"none"},null,8,["modelValue"]),be(Y(t,{type:"primary",onClick:h,icon:ee(yt),disabled:!_.value,circle:""},null,8,["icon","disabled"]),[[ee(Me)]])])],544)]),_:1}),Y(a,{label:"\u5728\u7EBF\u7528\u6237",name:"second"},{default:ve(()=>[W("div",Mr,[W("div",Pr,[(ie(!0),se(Fe,null,Be(ee(v).online,e=>(ie(),se("div",{class:"online-item",key:e.user_id},[W("div",Fr,[Y(l,{shape:"circle",size:38,src:e.avatar},null,8,["src"]),W("span",Br,de(e.username),1)])]))),128))])])]),_:1})]),_:1},8,["modelValue"])])}}});const Ur=We(kr,[["__scopeId","data-v-28543027"]]),jr=g=>{ke.fire({title:new TextDecoder("utf-8").decode(g.data),heightAuto:!1,confirmButtonColor:Ue.colorButtonTheme,icon:"error"}),bt.back()},Nr=(g,R,D)=>{if(!g.data)return;const F=dr(g.data);console.log(F),D.value.addBarrage(F),R.danmaku.draw({text:F.text,color:F.color,type:F.type}),console.log(F)},Wr=(g,R,D)=>{if(!g.data)return;const F=_r(g.data),P=F.list;D.value.updataOnline(P),console.log(F)},Gr=(g,R,D)=>{if(!g.data)return;const F=fr(g.data);D.value.addHistoryBarrage(F),console.log(F)};var ft={exports:{}};(function(g,R){(function(F,P){g.exports=P()})(self,function(){return function(){var D={"./node_modules/es6-promise/dist/es6-promise.js":function(O,v,_){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(x,h){O.exports=h()})(this,function(){function x(b){var I=typeof b;return b!==null&&(I==="object"||I==="function")}function h(b){return typeof b=="function"}var o=void 0;Array.isArray?o=Array.isArray:o=function(b){return Object.prototype.toString.call(b)==="[object Array]"};var i=o,d=0,r=void 0,l=void 0,u=function(I,w){y[d]=I,y[d+1]=w,d+=2,d===2&&(l?l(A):C())};function n(b){l=b}function t(b){u=b}var a=typeof window<"u"?window:void 0,s=a||{},e=s.MutationObserver||s.WebKitMutationObserver,f=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",c=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function p(){return function(){return process.nextTick(A)}}function E(){return typeof r<"u"?function(){r(A)}:m()}function L(){var b=0,I=new e(A),w=document.createTextNode("");return I.observe(w,{characterData:!0}),function(){w.data=b=++b%2}}function S(){var b=new MessageChannel;return b.port1.onmessage=A,function(){return b.port2.postMessage(0)}}function m(){var b=setTimeout;return function(){return b(A,1)}}var y=new Array(1e3);function A(){for(var b=0;b<d;b+=2){var I=y[b],w=y[b+1];I(w),y[b]=void 0,y[b+1]=void 0}d=0}function T(){try{var b=Function("return this")().require("vertx");return r=b.runOnLoop||b.runOnContext,E()}catch{return m()}}var C=void 0;f?C=p():e?C=L():c?C=S():a===void 0?C=T():C=m();function M(b,I){var w=this,B=new this.constructor(N);B[V]===void 0&&Le(B);var G=w._state;if(G){var H=arguments[G-1];u(function(){return Ee(G,B,H,w._result)})}else ae(w,B,b,I);return B}function K(b){var I=this;if(b&&typeof b=="object"&&b.constructor===I)return b;var w=new I(N);return oe(w,b),w}var V=Math.random().toString(36).substring(2);function N(){}var z=void 0,Q=1,j=2;function $(){return new TypeError("You cannot resolve a promise with itself")}function fe(){return new TypeError("A promises callback cannot return that same promise.")}function X(b,I,w,B){try{b.call(I,w,B)}catch(G){return G}}function Z(b,I,w){u(function(B){var G=!1,H=X(w,I,function(q){G||(G=!0,I!==q?oe(B,q):J(B,q))},function(q){G||(G=!0,U(B,q))},"Settle: "+(B._label||" unknown promise"));!G&&H&&(G=!0,U(B,H))},b)}function le(b,I){I._state===Q?J(b,I._result):I._state===j?U(b,I._result):ae(I,void 0,function(w){return oe(b,w)},function(w){return U(b,w)})}function re(b,I,w){I.constructor===b.constructor&&w===M&&I.constructor.resolve===K?le(b,I):w===void 0?J(b,I):h(w)?Z(b,I,w):J(b,I)}function oe(b,I){if(b===I)U(b,$());else if(x(I)){var w=void 0;try{w=I.then}catch(B){U(b,B);return}re(b,I,w)}else J(b,I)}function pe(b){b._onerror&&b._onerror(b._result),he(b)}function J(b,I){b._state===z&&(b._result=I,b._state=Q,b._subscribers.length!==0&&u(he,b))}function U(b,I){b._state===z&&(b._state=j,b._result=I,u(pe,b))}function ae(b,I,w,B){var G=b._subscribers,H=G.length;b._onerror=null,G[H]=I,G[H+Q]=w,G[H+j]=B,H===0&&b._state&&u(he,b)}function he(b){var I=b._subscribers,w=b._state;if(I.length!==0){for(var B=void 0,G=void 0,H=b._result,q=0;q<I.length;q+=3)B=I[q],G=I[q+w],B?Ee(w,B,G,H):G(H);b._subscribers.length=0}}function Ee(b,I,w,B){var G=h(w),H=void 0,q=void 0,Ae=!0;if(G){try{H=w(B)}catch(De){Ae=!1,q=De}if(I===H){U(I,fe());return}}else H=B;I._state!==z||(G&&Ae?oe(I,H):Ae===!1?U(I,q):b===Q?J(I,H):b===j&&U(I,H))}function me(b,I){try{I(function(B){oe(b,B)},function(B){U(b,B)})}catch(w){U(b,w)}}var ge=0;function Se(){return ge++}function Le(b){b[V]=ge++,b._state=void 0,b._result=void 0,b._subscribers=[]}function ce(){return new Error("Array Methods must be provided an Array")}var ue=function(){function b(I,w){this._instanceConstructor=I,this.promise=new I(N),this.promise[V]||Le(this.promise),i(w)?(this.length=w.length,this._remaining=w.length,this._result=new Array(this.length),this.length===0?J(this.promise,this._result):(this.length=this.length||0,this._enumerate(w),this._remaining===0&&J(this.promise,this._result))):U(this.promise,ce())}return b.prototype._enumerate=function(w){for(var B=0;this._state===z&&B<w.length;B++)this._eachEntry(w[B],B)},b.prototype._eachEntry=function(w,B){var G=this._instanceConstructor,H=G.resolve;if(H===K){var q=void 0,Ae=void 0,De=!1;try{q=w.then}catch(He){De=!0,Ae=He}if(q===M&&w._state!==z)this._settledAt(w._state,B,w._result);else if(typeof q!="function")this._remaining--,this._result[B]=w;else if(G===ne){var Ve=new G(N);De?U(Ve,Ae):re(Ve,w,q),this._willSettleAt(Ve,B)}else this._willSettleAt(new G(function(He){return He(w)}),B)}else this._willSettleAt(H(w),B)},b.prototype._settledAt=function(w,B,G){var H=this.promise;H._state===z&&(this._remaining--,w===j?U(H,G):this._result[B]=G),this._remaining===0&&J(H,this._result)},b.prototype._willSettleAt=function(w,B){var G=this;ae(w,void 0,function(H){return G._settledAt(Q,B,H)},function(H){return G._settledAt(j,B,H)})},b}();function Re(b){return new ue(this,b).promise}function Te(b){var I=this;return i(b)?new I(function(w,B){for(var G=b.length,H=0;H<G;H++)I.resolve(b[H]).then(w,B)}):new I(function(w,B){return B(new TypeError("You must pass an array to race."))})}function ht(b){var I=this,w=new I(N);return U(w,b),w}function ct(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function _t(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ne=function(){function b(I){this[V]=Se(),this._result=this._state=void 0,this._subscribers=[],N!==I&&(typeof I!="function"&&ct(),this instanceof b?me(this,I):_t())}return b.prototype.catch=function(w){return this.then(null,w)},b.prototype.finally=function(w){var B=this,G=B.constructor;return h(w)?B.then(function(H){return G.resolve(w()).then(function(){return H})},function(H){return G.resolve(w()).then(function(){throw H})}):B.then(w,w)},b}();ne.prototype.then=M,ne.all=Re,ne.race=Te,ne.resolve=K,ne.reject=ht,ne._setScheduler=n,ne._setAsap=t,ne._asap=u;function pt(){var b=void 0;if(typeof _.g<"u")b=_.g;else if(typeof self<"u")b=self;else try{b=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var I=b.Promise;if(I){var w=null;try{w=Object.prototype.toString.call(I.resolve())}catch{}if(w==="[object Promise]"&&!I.cast)return}b.Promise=ne}return ne.polyfill=pt,ne.Promise=ne,ne})},"./node_modules/events/events.js":function(O){var v=typeof Reflect=="object"?Reflect:null,_=v&&typeof v.apply=="function"?v.apply:function(m,y,A){return Function.prototype.apply.call(m,y,A)},x;v&&typeof v.ownKeys=="function"?x=v.ownKeys:Object.getOwnPropertySymbols?x=function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:x=function(m){return Object.getOwnPropertyNames(m)};function h(S){console&&console.warn&&console.warn(S)}var o=Number.isNaN||function(m){return m!==m};function i(){i.init.call(this)}O.exports=i,O.exports.once=p,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var d=10;function r(S){if(typeof S!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof S)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(S){if(typeof S!="number"||S<0||o(S))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+S+".");d=S}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(m){if(typeof m!="number"||m<0||o(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this};function l(S){return S._maxListeners===void 0?i.defaultMaxListeners:S._maxListeners}i.prototype.getMaxListeners=function(){return l(this)},i.prototype.emit=function(m){for(var y=[],A=1;A<arguments.length;A++)y.push(arguments[A]);var T=m==="error",C=this._events;if(C!==void 0)T=T&&C.error===void 0;else if(!T)return!1;if(T){var M;if(y.length>0&&(M=y[0]),M instanceof Error)throw M;var K=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw K.context=M,K}var V=C[m];if(V===void 0)return!1;if(typeof V=="function")_(V,this,y);else for(var N=V.length,z=e(V,N),A=0;A<N;++A)_(z[A],this,y);return!0};function u(S,m,y,A){var T,C,M;if(r(y),C=S._events,C===void 0?(C=S._events=Object.create(null),S._eventsCount=0):(C.newListener!==void 0&&(S.emit("newListener",m,y.listener?y.listener:y),C=S._events),M=C[m]),M===void 0)M=C[m]=y,++S._eventsCount;else if(typeof M=="function"?M=C[m]=A?[y,M]:[M,y]:A?M.unshift(y):M.push(y),T=l(S),T>0&&M.length>T&&!M.warned){M.warned=!0;var K=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(m)+" listeners added. Use emitter.setMaxListeners() to increase limit");K.name="MaxListenersExceededWarning",K.emitter=S,K.type=m,K.count=M.length,h(K)}return S}i.prototype.addListener=function(m,y){return u(this,m,y,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(m,y){return u(this,m,y,!0)};function n(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function t(S,m,y){var A={fired:!1,wrapFn:void 0,target:S,type:m,listener:y},T=n.bind(A);return T.listener=y,A.wrapFn=T,T}i.prototype.once=function(m,y){return r(y),this.on(m,t(this,m,y)),this},i.prototype.prependOnceListener=function(m,y){return r(y),this.prependListener(m,t(this,m,y)),this},i.prototype.removeListener=function(m,y){var A,T,C,M,K;if(r(y),T=this._events,T===void 0)return this;if(A=T[m],A===void 0)return this;if(A===y||A.listener===y)--this._eventsCount===0?this._events=Object.create(null):(delete T[m],T.removeListener&&this.emit("removeListener",m,A.listener||y));else if(typeof A!="function"){for(C=-1,M=A.length-1;M>=0;M--)if(A[M]===y||A[M].listener===y){K=A[M].listener,C=M;break}if(C<0)return this;C===0?A.shift():f(A,C),A.length===1&&(T[m]=A[0]),T.removeListener!==void 0&&this.emit("removeListener",m,K||y)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(m){var y,A,T;if(A=this._events,A===void 0)return this;if(A.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):A[m]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete A[m]),this;if(arguments.length===0){var C=Object.keys(A),M;for(T=0;T<C.length;++T)M=C[T],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(y=A[m],typeof y=="function")this.removeListener(m,y);else if(y!==void 0)for(T=y.length-1;T>=0;T--)this.removeListener(m,y[T]);return this};function a(S,m,y){var A=S._events;if(A===void 0)return[];var T=A[m];return T===void 0?[]:typeof T=="function"?y?[T.listener||T]:[T]:y?c(T):e(T,T.length)}i.prototype.listeners=function(m){return a(this,m,!0)},i.prototype.rawListeners=function(m){return a(this,m,!1)},i.listenerCount=function(S,m){return typeof S.listenerCount=="function"?S.listenerCount(m):s.call(S,m)},i.prototype.listenerCount=s;function s(S){var m=this._events;if(m!==void 0){var y=m[S];if(typeof y=="function")return 1;if(y!==void 0)return y.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?x(this._events):[]};function e(S,m){for(var y=new Array(m),A=0;A<m;++A)y[A]=S[A];return y}function f(S,m){for(;m+1<S.length;m++)S[m]=S[m+1];S.pop()}function c(S){for(var m=new Array(S.length),y=0;y<m.length;++y)m[y]=S[y].listener||S[y];return m}function p(S,m){return new Promise(function(y,A){function T(M){S.removeListener(m,C),A(M)}function C(){typeof S.removeListener=="function"&&S.removeListener("error",T),y([].slice.call(arguments))}L(S,m,C,{once:!0}),m!=="error"&&E(S,T,{once:!0})})}function E(S,m,y){typeof S.on=="function"&&L(S,"error",m,y)}function L(S,m,y,A){if(typeof S.on=="function")A.once?S.once(m,y):S.on(m,y);else if(typeof S.addEventListener=="function")S.addEventListener(m,function T(C){A.once&&S.removeEventListener(m,T),y(C)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof S)}},"./node_modules/webworkify-webpack/index.js":function(O,v,_){function x(n){var t={};function a(e){if(t[e])return t[e].exports;var f=t[e]={i:e,l:!1,exports:{}};return n[e].call(f.exports,f,f.exports,a),f.l=!0,f.exports}a.m=n,a.c=t,a.i=function(e){return e},a.d=function(e,f,c){a.o(e,f)||Object.defineProperty(e,f,{configurable:!1,enumerable:!0,get:c})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var f=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(f,"a",f),f},a.o=function(e,f){return Object.prototype.hasOwnProperty.call(e,f)},a.p="/",a.oe=function(e){throw console.error(e),e};var s=a(a.s=ENTRY_MODULE);return s.default||s}var h="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+h+").*?\\)";function i(n){return(n+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function d(n){return!isNaN(1*n)}function r(n,t,a){var s={};s[a]=[];var e=t.toString(),f=e.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!f)return s;for(var c=f[1],p=new RegExp("(\\\\n|\\W)"+i(c)+o,"g"),E;E=p.exec(e);)E[3]!=="dll-reference"&&s[a].push(E[3]);for(p=new RegExp("\\("+i(c)+'\\("(dll-reference\\s('+h+'))"\\)\\)'+o,"g");E=p.exec(e);)n[E[2]]||(s[a].push(E[1]),n[E[2]]=_(E[1]).m),s[E[2]]=s[E[2]]||[],s[E[2]].push(E[4]);for(var L=Object.keys(s),S=0;S<L.length;S++)for(var m=0;m<s[L[S]].length;m++)d(s[L[S]][m])&&(s[L[S]][m]=1*s[L[S]][m]);return s}function l(n){var t=Object.keys(n);return t.reduce(function(a,s){return a||n[s].length>0},!1)}function u(n,t){for(var a={main:[t]},s={main:[]},e={main:{}};l(a);)for(var f=Object.keys(a),c=0;c<f.length;c++){var p=f[c],E=a[p],L=E.pop();if(e[p]=e[p]||{},!(e[p][L]||!n[p][L])){e[p][L]=!0,s[p]=s[p]||[],s[p].push(L);for(var S=r(n,n[p][L],p),m=Object.keys(S),y=0;y<m.length;y++)a[m[y]]=a[m[y]]||[],a[m[y]]=a[m[y]].concat(S[m[y]])}}return s}O.exports=function(n,t){t=t||{};var a={main:_.m},s=t.all?{main:Object.keys(a.main)}:u(a,n),e="";Object.keys(s).filter(function(L){return L!=="main"}).forEach(function(L){for(var S=0;s[L][S];)S++;s[L].push(S),a[L][S]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",e=e+"var "+L+" = ("+x.toString().replace("ENTRY_MODULE",JSON.stringify(S))+")({"+s[L].map(function(m){return""+JSON.stringify(m)+": "+a[L][m].toString()}).join(",")+`});
`}),e=e+"new (("+x.toString().replace("ENTRY_MODULE",JSON.stringify(n))+")({"+s.main.map(function(L){return""+JSON.stringify(L)+": "+a.main[L].toString()}).join(",")+"}))(self);";var f=new window.Blob([e],{type:"text/javascript"});if(t.bare)return f;var c=window.URL||window.webkitURL||window.mozURL||window.msURL,p=c.createObjectURL(f),E=new window.Worker(p);return E.objectURL=p,E}},"./src/config.js":function(O,v,_){_.r(v),_.d(v,{defaultConfig:function(){return x},createDefaultConfig:function(){return h}});var x={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function h(){return Object.assign({},x)}},"./src/core/features.js":function(O,v,_){_.r(v);var x=_("./src/io/io-controller.js"),h=_("./src/config.js"),o=function(){function i(){}return i.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},i.supportNetworkStreamIO=function(){var d=new x.default({},(0,h.createDefaultConfig)()),r=d.loaderType;return d.destroy(),r=="fetch-stream-loader"||r=="xhr-moz-chunked-loader"},i.getNetworkLoaderTypeName=function(){var d=new x.default({},(0,h.createDefaultConfig)()),r=d.loaderType;return d.destroy(),r},i.supportNativeMediaPlayback=function(d){i.videoElement==null&&(i.videoElement=window.document.createElement("video"));var r=i.videoElement.canPlayType(d);return r==="probably"||r=="maybe"},i.getFeatureList=function(){var d={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return d.mseFlvPlayback=i.supportMSEH264Playback(),d.networkStreamIO=i.supportNetworkStreamIO(),d.networkLoaderName=i.getNetworkLoaderTypeName(),d.mseLiveFlvPlayback=d.mseFlvPlayback&&d.networkStreamIO,d.nativeMP4H264Playback=i.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),d.nativeWebmVP8Playback=i.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),d.nativeWebmVP9Playback=i.supportNativeMediaPlayback('video/webm; codecs="vp9"'),d},i}();v.default=o},"./src/core/media-info.js":function(O,v,_){_.r(v);var x=function(){function h(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return h.prototype.isComplete=function(){var o=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,i=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&o&&i},h.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},h.prototype.getNearestKeyframe=function(o){if(this.keyframesIndex==null)return null;var i=this.keyframesIndex,d=this._search(i.times,o);return{index:d,milliseconds:i.times[d],fileposition:i.filepositions[d]}},h.prototype._search=function(o,i){var d=0,r=o.length-1,l=0,u=0,n=r;for(i<o[0]&&(d=0,u=n+1);u<=n;)if(l=u+Math.floor((n-u)/2),l===r||i>=o[l]&&i<o[l+1]){d=l;break}else o[l]<i?u=l+1:n=l-1;return d},h}();v.default=x},"./src/core/media-segment-info.js":function(O,v,_){_.r(v),_.d(v,{SampleInfo:function(){return x},MediaSegmentInfo:function(){return h},IDRSampleList:function(){return o},MediaSegmentInfoList:function(){return i}});var x=function(){function d(r,l,u,n,t){this.dts=r,this.pts=l,this.duration=u,this.originalDts=n,this.isSyncPoint=t,this.fileposition=null}return d}(),h=function(){function d(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return d.prototype.appendSyncPoint=function(r){r.isSyncPoint=!0,this.syncPoints.push(r)},d}(),o=function(){function d(){this._list=[]}return d.prototype.clear=function(){this._list=[]},d.prototype.appendArray=function(r){var l=this._list;r.length!==0&&(l.length>0&&r[0].originalDts<l[l.length-1].originalDts&&this.clear(),Array.prototype.push.apply(l,r))},d.prototype.getLastSyncPointBeforeDts=function(r){if(this._list.length==0)return null;var l=this._list,u=0,n=l.length-1,t=0,a=0,s=n;for(r<l[0].dts&&(u=0,a=s+1);a<=s;)if(t=a+Math.floor((s-a)/2),t===n||r>=l[t].dts&&r<l[t+1].dts){u=t;break}else l[t].dts<r?a=t+1:s=t-1;return this._list[u]},d}(),i=function(){function d(r){this._type=r,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(d.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),d.prototype.isEmpty=function(){return this._list.length===0},d.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},d.prototype._searchNearestSegmentBefore=function(r){var l=this._list;if(l.length===0)return-2;var u=l.length-1,n=0,t=0,a=u,s=0;if(r<l[0].originalBeginDts)return s=-1,s;for(;t<=a;)if(n=t+Math.floor((a-t)/2),n===u||r>l[n].lastSample.originalDts&&r<l[n+1].originalBeginDts){s=n;break}else l[n].originalBeginDts<r?t=n+1:a=n-1;return s},d.prototype._searchNearestSegmentAfter=function(r){return this._searchNearestSegmentBefore(r)+1},d.prototype.append=function(r){var l=this._list,u=r,n=this._lastAppendLocation,t=0;n!==-1&&n<l.length&&u.originalBeginDts>=l[n].lastSample.originalDts&&(n===l.length-1||n<l.length-1&&u.originalBeginDts<l[n+1].originalBeginDts)?t=n+1:l.length>0&&(t=this._searchNearestSegmentBefore(u.originalBeginDts)+1),this._lastAppendLocation=t,this._list.splice(t,0,u)},d.prototype.getLastSegmentBefore=function(r){var l=this._searchNearestSegmentBefore(r);return l>=0?this._list[l]:null},d.prototype.getLastSampleBefore=function(r){var l=this.getLastSegmentBefore(r);return l!=null?l.lastSample:null},d.prototype.getLastSyncPointBefore=function(r){for(var l=this._searchNearestSegmentBefore(r),u=this._list[l].syncPoints;u.length===0&&l>0;)l--,u=this._list[l].syncPoints;return u.length>0?u[u.length-1]:null},d}()},"./src/core/mse-controller.js":function(O,v,_){_.r(v);var x=_("./node_modules/events/events.js"),h=_.n(x),o=_("./src/utils/logger.js"),i=_("./src/utils/browser.js"),d=_("./src/core/mse-events.js"),r=_("./src/core/media-segment-info.js"),l=_("./src/utils/exception.js"),u=function(){function n(t){this.TAG="MSEController",this._config=t,this._emitter=new(h()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new r.IDRSampleList}return n.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},n.prototype.on=function(t,a){this._emitter.addListener(t,a)},n.prototype.off=function(t,a){this._emitter.removeListener(t,a)},n.prototype.attachMediaElement=function(t){if(this._mediaSource)throw new l.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var a=this._mediaSource=new window.MediaSource;a.addEventListener("sourceopen",this.e.onSourceOpen),a.addEventListener("sourceended",this.e.onSourceEnded),a.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=t,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),t.src=this._mediaSourceObjectURL},n.prototype.detachMediaElement=function(){if(this._mediaSource){var t=this._mediaSource;for(var a in this._sourceBuffers){var s=this._pendingSegments[a];s.splice(0,s.length),this._pendingSegments[a]=null,this._pendingRemoveRanges[a]=null,this._lastInitSegments[a]=null;var e=this._sourceBuffers[a];if(e){if(t.readyState!=="closed"){try{t.removeSourceBuffer(e)}catch(f){o.default.e(this.TAG,f.message)}e.removeEventListener("error",this.e.onSourceBufferError),e.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[a]=null,this._sourceBuffers[a]=null}}if(t.readyState==="open")try{t.endOfStream()}catch(f){o.default.e(this.TAG,f.message)}t.removeEventListener("sourceopen",this.e.onSourceOpen),t.removeEventListener("sourceended",this.e.onSourceEnded),t.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},n.prototype.appendInitSegment=function(t,a){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(t),this._pendingSegments[t.type].push(t);return}var s=t,e=""+s.container;s.codec&&s.codec.length>0&&(e+=";codecs="+s.codec);var f=!1;if(o.default.v(this.TAG,"Received Initialization Segment, mimeType: "+e),this._lastInitSegments[s.type]=s,e!==this._mimeTypes[s.type]){if(this._mimeTypes[s.type])o.default.v(this.TAG,"Notice: "+s.type+" mimeType changed, origin: "+this._mimeTypes[s.type]+", target: "+e);else{f=!0;try{var c=this._sourceBuffers[s.type]=this._mediaSource.addSourceBuffer(e);c.addEventListener("error",this.e.onSourceBufferError),c.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(p){o.default.e(this.TAG,p.message),this._emitter.emit(d.default.ERROR,{code:p.code,msg:p.message});return}}this._mimeTypes[s.type]=e}a||this._pendingSegments[s.type].push(s),f||this._sourceBuffers[s.type]&&!this._sourceBuffers[s.type].updating&&this._doAppendSegments(),i.default.safari&&s.container==="audio/mpeg"&&s.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=s.mediaDuration/1e3,this._updateMediaSourceDuration())},n.prototype.appendMediaSegment=function(t){var a=t;this._pendingSegments[a.type].push(a),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var s=this._sourceBuffers[a.type];s&&!s.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},n.prototype.seek=function(t){for(var a in this._sourceBuffers)if(!!this._sourceBuffers[a]){var s=this._sourceBuffers[a];if(this._mediaSource.readyState==="open")try{s.abort()}catch(L){o.default.e(this.TAG,L.message)}this._idrList.clear();var e=this._pendingSegments[a];if(e.splice(0,e.length),this._mediaSource.readyState!=="closed"){for(var f=0;f<s.buffered.length;f++){var c=s.buffered.start(f),p=s.buffered.end(f);this._pendingRemoveRanges[a].push({start:c,end:p})}if(s.updating||this._doRemoveRanges(),i.default.safari){var E=this._lastInitSegments[a];E&&(this._pendingSegments[a].push(E),s.updating||this._doAppendSegments())}}}},n.prototype.endOfStream=function(){var t=this._mediaSource,a=this._sourceBuffers;if(!t||t.readyState!=="open"){t&&t.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}a.video&&a.video.updating||a.audio&&a.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,t.endOfStream())},n.prototype.getNearestKeyframe=function(t){return this._idrList.getLastSyncPointBeforeDts(t)},n.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var t=this._mediaElement.currentTime;for(var a in this._sourceBuffers){var s=this._sourceBuffers[a];if(s){var e=s.buffered;if(e.length>=1&&t-e.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},n.prototype._doCleanupSourceBuffer=function(){var t=this._mediaElement.currentTime;for(var a in this._sourceBuffers){var s=this._sourceBuffers[a];if(s){for(var e=s.buffered,f=!1,c=0;c<e.length;c++){var p=e.start(c),E=e.end(c);if(p<=t&&t<E+3){if(t-p>=this._config.autoCleanupMaxBackwardDuration){f=!0;var L=t-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[a].push({start:p,end:L})}}else E<t&&(f=!0,this._pendingRemoveRanges[a].push({start:p,end:E}))}f&&!s.updating&&this._doRemoveRanges()}}},n.prototype._updateMediaSourceDuration=function(){var t=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(t.video&&t.video.updating||t.audio&&t.audio.updating)){var a=this._mediaSource.duration,s=this._pendingMediaDuration;s>0&&(isNaN(a)||s>a)&&(o.default.v(this.TAG,"Update MediaSource duration from "+a+" to "+s),this._mediaSource.duration=s),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},n.prototype._doRemoveRanges=function(){for(var t in this._pendingRemoveRanges)if(!(!this._sourceBuffers[t]||this._sourceBuffers[t].updating))for(var a=this._sourceBuffers[t],s=this._pendingRemoveRanges[t];s.length&&!a.updating;){var e=s.shift();a.remove(e.start,e.end)}},n.prototype._doAppendSegments=function(){var t=this._pendingSegments;for(var a in t)if(!(!this._sourceBuffers[a]||this._sourceBuffers[a].updating)&&t[a].length>0){var s=t[a].shift();if(s.timestampOffset){var e=this._sourceBuffers[a].timestampOffset,f=s.timestampOffset/1e3,c=Math.abs(e-f);c>.1&&(o.default.v(this.TAG,"Update MPEG audio timestampOffset from "+e+" to "+f),this._sourceBuffers[a].timestampOffset=f),delete s.timestampOffset}if(!s.data||s.data.byteLength===0)continue;try{this._sourceBuffers[a].appendBuffer(s.data),this._isBufferFull=!1,a==="video"&&s.hasOwnProperty("info")&&this._idrList.appendArray(s.info.syncPoints)}catch(p){this._pendingSegments[a].unshift(s),p.code===22?(this._isBufferFull||this._emitter.emit(d.default.BUFFER_FULL),this._isBufferFull=!0):(o.default.e(this.TAG,p.message),this._emitter.emit(d.default.ERROR,{code:p.code,msg:p.message}))}}},n.prototype._onSourceOpen=function(){if(o.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var t=this._pendingSourceBufferInit;t.length;){var a=t.shift();this.appendInitSegment(a,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(d.default.SOURCE_OPEN)},n.prototype._onSourceEnded=function(){o.default.v(this.TAG,"MediaSource onSourceEnded")},n.prototype._onSourceClose=function(){o.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},n.prototype._hasPendingSegments=function(){var t=this._pendingSegments;return t.video.length>0||t.audio.length>0},n.prototype._hasPendingRemoveRanges=function(){var t=this._pendingRemoveRanges;return t.video.length>0||t.audio.length>0},n.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(d.default.UPDATE_END)},n.prototype._onSourceBufferError=function(t){o.default.e(this.TAG,"SourceBuffer Error: "+t)},n}();v.default=u},"./src/core/mse-events.js":function(O,v,_){_.r(v);var x={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};v.default=x},"./src/core/transmuxer.js":function(O,v,_){_.r(v);var x=_("./node_modules/events/events.js"),h=_.n(x),o=_("./node_modules/webworkify-webpack/index.js"),i=_.n(o),d=_("./src/utils/logger.js"),r=_("./src/utils/logging-control.js"),l=_("./src/core/transmuxing-controller.js"),u=_("./src/core/transmuxing-events.js"),n=_("./src/core/media-info.js"),t=function(){function a(s,e){if(this.TAG="Transmuxer",this._emitter=new(h()),e.enableWorker&&typeof Worker<"u")try{this._worker=i()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[s,e]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},r.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:r.default.getConfig()})}catch{d.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new l.default(s,e)}else this._controller=new l.default(s,e);if(this._controller){var f=this._controller;f.on(u.default.IO_ERROR,this._onIOError.bind(this)),f.on(u.default.DEMUX_ERROR,this._onDemuxError.bind(this)),f.on(u.default.INIT_SEGMENT,this._onInitSegment.bind(this)),f.on(u.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),f.on(u.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),f.on(u.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),f.on(u.default.MEDIA_INFO,this._onMediaInfo.bind(this)),f.on(u.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),f.on(u.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),f.on(u.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),f.on(u.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return a.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),r.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},a.prototype.on=function(s,e){this._emitter.addListener(s,e)},a.prototype.off=function(s,e){this._emitter.removeListener(s,e)},a.prototype.hasWorker=function(){return this._worker!=null},a.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},a.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},a.prototype.seek=function(s){this._worker?this._worker.postMessage({cmd:"seek",param:s}):this._controller.seek(s)},a.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},a.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},a.prototype._onInitSegment=function(s,e){var f=this;Promise.resolve().then(function(){f._emitter.emit(u.default.INIT_SEGMENT,s,e)})},a.prototype._onMediaSegment=function(s,e){var f=this;Promise.resolve().then(function(){f._emitter.emit(u.default.MEDIA_SEGMENT,s,e)})},a.prototype._onLoadingComplete=function(){var s=this;Promise.resolve().then(function(){s._emitter.emit(u.default.LOADING_COMPLETE)})},a.prototype._onRecoveredEarlyEof=function(){var s=this;Promise.resolve().then(function(){s._emitter.emit(u.default.RECOVERED_EARLY_EOF)})},a.prototype._onMediaInfo=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(u.default.MEDIA_INFO,s)})},a.prototype._onMetaDataArrived=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(u.default.METADATA_ARRIVED,s)})},a.prototype._onScriptDataArrived=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(u.default.SCRIPTDATA_ARRIVED,s)})},a.prototype._onStatisticsInfo=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(u.default.STATISTICS_INFO,s)})},a.prototype._onIOError=function(s,e){var f=this;Promise.resolve().then(function(){f._emitter.emit(u.default.IO_ERROR,s,e)})},a.prototype._onDemuxError=function(s,e){var f=this;Promise.resolve().then(function(){f._emitter.emit(u.default.DEMUX_ERROR,s,e)})},a.prototype._onRecommendSeekpoint=function(s){var e=this;Promise.resolve().then(function(){e._emitter.emit(u.default.RECOMMEND_SEEKPOINT,s)})},a.prototype._onLoggingConfigChanged=function(s){this._worker&&this._worker.postMessage({cmd:"logging_config",param:s})},a.prototype._onWorkerMessage=function(s){var e=s.data,f=e.data;if(e.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(e.msg){case u.default.INIT_SEGMENT:case u.default.MEDIA_SEGMENT:this._emitter.emit(e.msg,f.type,f.data);break;case u.default.LOADING_COMPLETE:case u.default.RECOVERED_EARLY_EOF:this._emitter.emit(e.msg);break;case u.default.MEDIA_INFO:Object.setPrototypeOf(f,n.default.prototype),this._emitter.emit(e.msg,f);break;case u.default.METADATA_ARRIVED:case u.default.SCRIPTDATA_ARRIVED:case u.default.STATISTICS_INFO:this._emitter.emit(e.msg,f);break;case u.default.IO_ERROR:case u.default.DEMUX_ERROR:this._emitter.emit(e.msg,f.type,f.info);break;case u.default.RECOMMEND_SEEKPOINT:this._emitter.emit(e.msg,f);break;case"logcat_callback":d.default.emitter.emit("log",f.type,f.logcat);break}},a}();v.default=t},"./src/core/transmuxing-controller.js":function(O,v,_){_.r(v);var x=_("./node_modules/events/events.js"),h=_.n(x),o=_("./src/utils/logger.js"),i=_("./src/utils/browser.js"),d=_("./src/core/media-info.js"),r=_("./src/demux/flv-demuxer.js"),l=_("./src/remux/mp4-remuxer.js"),u=_("./src/demux/demux-errors.js"),n=_("./src/io/io-controller.js"),t=_("./src/core/transmuxing-events.js"),a=function(){function s(e,f){this.TAG="TransmuxingController",this._emitter=new(h()),this._config=f,e.segments||(e.segments=[{duration:e.duration,filesize:e.filesize,url:e.url}]),typeof e.cors!="boolean"&&(e.cors=!0),typeof e.withCredentials!="boolean"&&(e.withCredentials=!1),this._mediaDataSource=e,this._currentSegmentIndex=0;var c=0;this._mediaDataSource.segments.forEach(function(p){p.timestampBase=c,c+=p.duration,p.cors=e.cors,p.withCredentials=e.withCredentials,f.referrerPolicy&&(p.referrerPolicy=f.referrerPolicy)}),!isNaN(c)&&this._mediaDataSource.duration!==c&&(this._mediaDataSource.duration=c),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return s.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},s.prototype.on=function(e,f){this._emitter.addListener(e,f)},s.prototype.off=function(e,f){this._emitter.removeListener(e,f)},s.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},s.prototype._loadSegment=function(e,f){this._currentSegmentIndex=e;var c=this._mediaDataSource.segments[e],p=this._ioctl=new n.default(c,this._config,e);p.onError=this._onIOException.bind(this),p.onSeeked=this._onIOSeeked.bind(this),p.onComplete=this._onIOComplete.bind(this),p.onRedirect=this._onIORedirect.bind(this),p.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),f?this._demuxer.bindDataSource(this._ioctl):p.onDataArrival=this._onInitChunkArrival.bind(this),p.open(f)},s.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},s.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},s.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},s.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},s.prototype.seek=function(e){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var f=this._searchSegmentIndexContains(e);if(f===this._currentSegmentIndex){var c=this._mediaInfo.segments[f];if(c==null)this._pendingSeekTime=e;else{var p=c.getNearestKeyframe(e);this._remuxer.seek(p.milliseconds),this._ioctl.seek(p.fileposition),this._pendingResolveSeekPoint=p.milliseconds}}else{var E=this._mediaInfo.segments[f];if(E==null)this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(f);else{var p=E.getNearestKeyframe(e);this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[f].timestampBase,this._loadSegment(f,p.fileposition),this._pendingResolveSeekPoint=p.milliseconds,this._reportSegmentMediaInfo(f)}}this._enableStatisticsReporter()}},s.prototype._searchSegmentIndexContains=function(e){for(var f=this._mediaDataSource.segments,c=f.length-1,p=0;p<f.length;p++)if(e<f[p].timestampBase){c=p-1;break}return c},s.prototype._onInitChunkArrival=function(e,f){var c=this,p=null,E=0;if(f>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,E=this._demuxer.parseChunks(e,f);else if((p=r.default.probe(e)).match){this._demuxer=new r.default(p,this._config),this._remuxer||(this._remuxer=new l.default(this._config));var L=this._mediaDataSource;L.duration!=null&&!isNaN(L.duration)&&(this._demuxer.overridedDuration=L.duration),typeof L.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=L.hasAudio),typeof L.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=L.hasVideo),this._demuxer.timestampBase=L.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),E=this._demuxer.parseChunks(e,f)}else p=null,o.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){c._internalAbort()}),this._emitter.emit(t.default.DEMUX_ERROR,u.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),E=0;return E},s.prototype._onMediaInfo=function(e){var f=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,d.default.prototype));var c=Object.assign({},e);Object.setPrototypeOf(c,d.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=c,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var p=f._pendingSeekTime;f._pendingSeekTime=null,f.seek(p)})},s.prototype._onMetaDataArrived=function(e){this._emitter.emit(t.default.METADATA_ARRIVED,e)},s.prototype._onScriptDataArrived=function(e){this._emitter.emit(t.default.SCRIPTDATA_ARRIVED,e)},s.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},s.prototype._onIOComplete=function(e){var f=e,c=f+1;c<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(c)):(this._remuxer.flushStashedSamples(),this._emitter.emit(t.default.LOADING_COMPLETE),this._disableStatisticsReporter())},s.prototype._onIORedirect=function(e){var f=this._ioctl.extraData;this._mediaDataSource.segments[f].redirectedURL=e},s.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(t.default.RECOVERED_EARLY_EOF)},s.prototype._onIOException=function(e,f){o.default.e(this.TAG,"IOException: type = "+e+", code = "+f.code+", msg = "+f.msg),this._emitter.emit(t.default.IO_ERROR,e,f),this._disableStatisticsReporter()},s.prototype._onDemuxException=function(e,f){o.default.e(this.TAG,"DemuxException: type = "+e+", info = "+f),this._emitter.emit(t.default.DEMUX_ERROR,e,f)},s.prototype._onRemuxerInitSegmentArrival=function(e,f){this._emitter.emit(t.default.INIT_SEGMENT,e,f)},s.prototype._onRemuxerMediaSegmentArrival=function(e,f){if(this._pendingSeekTime==null&&(this._emitter.emit(t.default.MEDIA_SEGMENT,e,f),this._pendingResolveSeekPoint!=null&&e==="video")){var c=f.info.syncPoints,p=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,i.default.safari&&c.length>0&&c[0].originalDts===p&&(p=c[0].pts),this._emitter.emit(t.default.RECOMMEND_SEEKPOINT,p)}},s.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},s.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},s.prototype._reportSegmentMediaInfo=function(e){var f=this._mediaInfo.segments[e],c=Object.assign({},f);c.duration=this._mediaInfo.duration,c.segmentCount=this._mediaInfo.segmentCount,delete c.segments,delete c.keyframesIndex,this._emitter.emit(t.default.MEDIA_INFO,c)},s.prototype._reportStatisticsInfo=function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(t.default.STATISTICS_INFO,e)},s}();v.default=a},"./src/core/transmuxing-events.js":function(O,v,_){_.r(v);var x={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};v.default=x},"./src/core/transmuxing-worker.js":function(O,v,_){_.r(v);var x=_("./src/utils/logging-control.js"),h=_("./src/utils/polyfill.js"),o=_("./src/core/transmuxing-controller.js"),i=_("./src/core/transmuxing-events.js"),d=function(r){var l=null,u=m.bind(this);h.default.install(),r.addEventListener("message",function(y){switch(y.data.cmd){case"init":l=new o.default(y.data.param[0],y.data.param[1]),l.on(i.default.IO_ERROR,E.bind(this)),l.on(i.default.DEMUX_ERROR,L.bind(this)),l.on(i.default.INIT_SEGMENT,n.bind(this)),l.on(i.default.MEDIA_SEGMENT,t.bind(this)),l.on(i.default.LOADING_COMPLETE,a.bind(this)),l.on(i.default.RECOVERED_EARLY_EOF,s.bind(this)),l.on(i.default.MEDIA_INFO,e.bind(this)),l.on(i.default.METADATA_ARRIVED,f.bind(this)),l.on(i.default.SCRIPTDATA_ARRIVED,c.bind(this)),l.on(i.default.STATISTICS_INFO,p.bind(this)),l.on(i.default.RECOMMEND_SEEKPOINT,S.bind(this));break;case"destroy":l&&(l.destroy(),l=null),r.postMessage({msg:"destroyed"});break;case"start":l.start();break;case"stop":l.stop();break;case"seek":l.seek(y.data.param);break;case"pause":l.pause();break;case"resume":l.resume();break;case"logging_config":{var A=y.data.param;x.default.applyConfig(A),A.enableCallback===!0?x.default.addLogListener(u):x.default.removeLogListener(u);break}}});function n(y,A){var T={msg:i.default.INIT_SEGMENT,data:{type:y,data:A}};r.postMessage(T,[A.data])}function t(y,A){var T={msg:i.default.MEDIA_SEGMENT,data:{type:y,data:A}};r.postMessage(T,[A.data])}function a(){var y={msg:i.default.LOADING_COMPLETE};r.postMessage(y)}function s(){var y={msg:i.default.RECOVERED_EARLY_EOF};r.postMessage(y)}function e(y){var A={msg:i.default.MEDIA_INFO,data:y};r.postMessage(A)}function f(y){var A={msg:i.default.METADATA_ARRIVED,data:y};r.postMessage(A)}function c(y){var A={msg:i.default.SCRIPTDATA_ARRIVED,data:y};r.postMessage(A)}function p(y){var A={msg:i.default.STATISTICS_INFO,data:y};r.postMessage(A)}function E(y,A){r.postMessage({msg:i.default.IO_ERROR,data:{type:y,info:A}})}function L(y,A){r.postMessage({msg:i.default.DEMUX_ERROR,data:{type:y,info:A}})}function S(y){r.postMessage({msg:i.default.RECOMMEND_SEEKPOINT,data:y})}function m(y,A){r.postMessage({msg:"logcat_callback",data:{type:y,logcat:A}})}};v.default=d},"./src/demux/amf-parser.js":function(O,v,_){_.r(v);var x=_("./src/utils/logger.js"),h=_("./src/utils/utf8-conv.js"),o=_("./src/utils/exception.js"),i=function(){var r=new ArrayBuffer(2);return new DataView(r).setInt16(0,256,!0),new Int16Array(r)[0]===256}(),d=function(){function r(){}return r.parseScriptData=function(l,u,n){var t={};try{var a=r.parseValue(l,u,n),s=r.parseValue(l,u+a.size,n-a.size);t[a.data]=s.data}catch(e){x.default.e("AMF",e.toString())}return t},r.parseObject=function(l,u,n){if(n<3)throw new o.IllegalStateException("Data not enough when parse ScriptDataObject");var t=r.parseString(l,u,n),a=r.parseValue(l,u+t.size,n-t.size),s=a.objectEnd;return{data:{name:t.data,value:a.data},size:t.size+a.size,objectEnd:s}},r.parseVariable=function(l,u,n){return r.parseObject(l,u,n)},r.parseString=function(l,u,n){if(n<2)throw new o.IllegalStateException("Data not enough when parse String");var t=new DataView(l,u,n),a=t.getUint16(0,!i),s;return a>0?s=(0,h.default)(new Uint8Array(l,u+2,a)):s="",{data:s,size:2+a}},r.parseLongString=function(l,u,n){if(n<4)throw new o.IllegalStateException("Data not enough when parse LongString");var t=new DataView(l,u,n),a=t.getUint32(0,!i),s;return a>0?s=(0,h.default)(new Uint8Array(l,u+4,a)):s="",{data:s,size:4+a}},r.parseDate=function(l,u,n){if(n<10)throw new o.IllegalStateException("Data size invalid when parse Date");var t=new DataView(l,u,n),a=t.getFloat64(0,!i),s=t.getInt16(8,!i);return a+=s*60*1e3,{data:new Date(a),size:8+2}},r.parseValue=function(l,u,n){if(n<1)throw new o.IllegalStateException("Data not enough when parse Value");var t=new DataView(l,u,n),a=1,s=t.getUint8(0),e,f=!1;try{switch(s){case 0:e=t.getFloat64(1,!i),a+=8;break;case 1:{var c=t.getUint8(1);e=!!c,a+=1;break}case 2:{var p=r.parseString(l,u+1,n-1);e=p.data,a+=p.size;break}case 3:{e={};var E=0;for((t.getUint32(n-4,!i)&16777215)===9&&(E=3);a<n-4;){var L=r.parseObject(l,u+a,n-a-E);if(L.objectEnd)break;e[L.data.name]=L.data.value,a+=L.size}if(a<=n-3){var S=t.getUint32(a-1,!i)&16777215;S===9&&(a+=3)}break}case 8:{e={},a+=4;var E=0;for((t.getUint32(n-4,!i)&16777215)===9&&(E=3);a<n-8;){var m=r.parseVariable(l,u+a,n-a-E);if(m.objectEnd)break;e[m.data.name]=m.data.value,a+=m.size}if(a<=n-3){var S=t.getUint32(a-1,!i)&16777215;S===9&&(a+=3)}break}case 9:e=void 0,a=1,f=!0;break;case 10:{e=[];var y=t.getUint32(1,!i);a+=4;for(var A=0;A<y;A++){var T=r.parseValue(l,u+a,n-a);e.push(T.data),a+=T.size}break}case 11:{var C=r.parseDate(l,u+1,n-1);e=C.data,a+=C.size;break}case 12:{var M=r.parseString(l,u+1,n-1);e=M.data,a+=M.size;break}default:a=n,x.default.w("AMF","Unsupported AMF value type "+s)}}catch(K){x.default.e("AMF",K.toString())}return{data:e,size:a,objectEnd:f}},r}();v.default=d},"./src/demux/demux-errors.js":function(O,v,_){_.r(v);var x={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};v.default=x},"./src/demux/exp-golomb.js":function(O,v,_){_.r(v);var x=_("./src/utils/exception.js"),h=function(){function o(i){this.TAG="ExpGolomb",this._buffer=i,this._buffer_index=0,this._total_bytes=i.byteLength,this._total_bits=i.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return o.prototype.destroy=function(){this._buffer=null},o.prototype._fillCurrentWord=function(){var i=this._total_bytes-this._buffer_index;if(i<=0)throw new x.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var d=Math.min(4,i),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+d)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=d,this._current_word_bits_left=d*8},o.prototype.readBits=function(i){if(i>32)throw new x.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(i<=this._current_word_bits_left){var d=this._current_word>>>32-i;return this._current_word<<=i,this._current_word_bits_left-=i,d}var r=this._current_word_bits_left?this._current_word:0;r=r>>>32-this._current_word_bits_left;var l=i-this._current_word_bits_left;this._fillCurrentWord();var u=Math.min(l,this._current_word_bits_left),n=this._current_word>>>32-u;return this._current_word<<=u,this._current_word_bits_left-=u,r=r<<u|n,r},o.prototype.readBool=function(){return this.readBits(1)===1},o.prototype.readByte=function(){return this.readBits(8)},o.prototype._skipLeadingZero=function(){var i;for(i=0;i<this._current_word_bits_left;i++)if((this._current_word&2147483648>>>i)!==0)return this._current_word<<=i,this._current_word_bits_left-=i,i;return this._fillCurrentWord(),i+this._skipLeadingZero()},o.prototype.readUEG=function(){var i=this._skipLeadingZero();return this.readBits(i+1)-1},o.prototype.readSEG=function(){var i=this.readUEG();return i&1?i+1>>>1:-1*(i>>>1)},o}();v.default=h},"./src/demux/flv-demuxer.js":function(O,v,_){_.r(v);var x=_("./src/utils/logger.js"),h=_("./src/demux/amf-parser.js"),o=_("./src/demux/sps-parser.js"),i=_("./src/demux/demux-errors.js"),d=_("./src/core/media-info.js"),r=_("./src/utils/exception.js");function l(n,t){return n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3]}var u=function(){function n(t,a){this.TAG="FLVDemuxer",this._config=a,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new d.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var s=new ArrayBuffer(2);return new DataView(s).setInt16(0,256,!0),new Int16Array(s)[0]===256}()}return n.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},n.probe=function(t){var a=new Uint8Array(t),s={match:!1};if(a[0]!==70||a[1]!==76||a[2]!==86||a[3]!==1)return s;var e=(a[4]&4)>>>2!==0,f=(a[4]&1)!==0,c=l(a,5);return c<9?s:{match:!0,consumed:c,dataOffset:c,hasAudioTrack:e,hasVideoTrack:f}},n.prototype.bindDataSource=function(t){return t.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(n.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(t){this._onTrackMetadata=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(t){this._onMediaInfo=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(t){this._onMetaDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(t){this._onScriptDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(t){this._onDataAvailable=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(t){this._timestampBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"overridedDuration",{get:function(){return this._duration},set:function(t){this._durationOverrided=!0,this._duration=t,this._mediaInfo.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"overridedHasAudio",{set:function(t){this._hasAudioFlagOverrided=!0,this._hasAudio=t,this._mediaInfo.hasAudio=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"overridedHasVideo",{set:function(t){this._hasVideoFlagOverrided=!0,this._hasVideo=t,this._mediaInfo.hasVideo=t},enumerable:!1,configurable:!0}),n.prototype.resetMediaInfo=function(){this._mediaInfo=new d.default},n.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},n.prototype.parseChunks=function(t,a){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new r.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var s=0,e=this._littleEndian;if(a===0)if(t.byteLength>13){var f=n.probe(t);s=f.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,a+s!==this._dataOffset&&x.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var c=new DataView(t,s),p=c.getUint32(0,!e);p!==0&&x.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),s+=4}for(;s<t.byteLength;){this._dispatch=!0;var c=new DataView(t,s);if(s+11+4>t.byteLength)break;var E=c.getUint8(0),L=c.getUint32(0,!e)&16777215;if(s+11+L+4>t.byteLength)break;if(E!==8&&E!==9&&E!==18){x.default.w(this.TAG,"Unsupported tag type "+E+", skipped"),s+=11+L+4;continue}var S=c.getUint8(4),m=c.getUint8(5),y=c.getUint8(6),A=c.getUint8(7),T=y|m<<8|S<<16|A<<24,C=c.getUint32(7,!e)&16777215;C!==0&&x.default.w(this.TAG,"Meet tag which has StreamID != 0!");var M=s+11;switch(E){case 8:this._parseAudioData(t,M,L,T);break;case 9:this._parseVideoData(t,M,L,T,a+s);break;case 18:this._parseScriptData(t,M,L);break}var K=c.getUint32(11+L,!e);K!==11+L&&x.default.w(this.TAG,"Invalid PrevTagSize "+K),s+=11+L+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),s},n.prototype._parseScriptData=function(t,a,s){var e=h.default.parseScriptData(t,a,s);if(e.hasOwnProperty("onMetaData")){if(e.onMetaData==null||typeof e.onMetaData!="object"){x.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&x.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=e;var f=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},f)),typeof f.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=f.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof f.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=f.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof f.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=f.audiodatarate),typeof f.videodatarate=="number"&&(this._mediaInfo.videoDataRate=f.videodatarate),typeof f.width=="number"&&(this._mediaInfo.width=f.width),typeof f.height=="number"&&(this._mediaInfo.height=f.height),typeof f.duration=="number"){if(!this._durationOverrided){var c=Math.floor(f.duration*this._timescale);this._duration=c,this._mediaInfo.duration=c}}else this._mediaInfo.duration=0;if(typeof f.framerate=="number"){var p=Math.floor(f.framerate*1e3);if(p>0){var E=p/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=E,this._referenceFrameRate.fps_num=p,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=E}}if(typeof f.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var L=f.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(L),f.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=f,x.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(e).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},e))},n.prototype._parseKeyframesIndex=function(t){for(var a=[],s=[],e=1;e<t.times.length;e++){var f=this._timestampBase+Math.floor(t.times[e]*1e3);a.push(f),s.push(t.filepositions[e])}return{times:a,filepositions:s}},n.prototype._parseAudioData=function(t,a,s,e){if(s<=1){x.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var f=new DataView(t,a,s),c=f.getUint8(0),p=c>>>4;if(p!==2&&p!==10){this._onError(i.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+p);return}var E=0,L=(c&12)>>>2;if(L>=0&&L<=4)E=this._flvSoundRateTable[L];else{this._onError(i.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+L);return}var S=c&1,m=this._audioMetadata,y=this._audioTrack;if(m||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),m=this._audioMetadata={},m.type="audio",m.id=y.id,m.timescale=this._timescale,m.duration=this._duration,m.audioSampleRate=E,m.channelCount=S===0?1:2),p===10){var A=this._parseAACAudioData(t,a+1,s-1);if(A==null)return;if(A.packetType===0){m.config&&x.default.w(this.TAG,"Found another AudioSpecificConfig!");var T=A.data;m.audioSampleRate=T.samplingRate,m.channelCount=T.channelCount,m.codec=T.codec,m.originalCodec=T.originalCodec,m.config=T.config,m.refSampleDuration=1024/m.audioSampleRate*m.timescale,x.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",m);var C=this._mediaInfo;C.audioCodec=m.originalCodec,C.audioSampleRate=m.audioSampleRate,C.audioChannelCount=m.channelCount,C.hasVideo?C.videoCodec!=null&&(C.mimeType='video/x-flv; codecs="'+C.videoCodec+","+C.audioCodec+'"'):C.mimeType='video/x-flv; codecs="'+C.audioCodec+'"',C.isComplete()&&this._onMediaInfo(C)}else if(A.packetType===1){var M=this._timestampBase+e,K={unit:A.data,length:A.data.byteLength,dts:M,pts:M};y.samples.push(K),y.length+=A.data.length}else x.default.e(this.TAG,"Flv: Unsupported AAC data type "+A.packetType)}else if(p===2){if(!m.codec){var T=this._parseMP3AudioData(t,a+1,s-1,!0);if(T==null)return;m.audioSampleRate=T.samplingRate,m.channelCount=T.channelCount,m.codec=T.codec,m.originalCodec=T.originalCodec,m.refSampleDuration=1152/m.audioSampleRate*m.timescale,x.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",m);var C=this._mediaInfo;C.audioCodec=m.codec,C.audioSampleRate=m.audioSampleRate,C.audioChannelCount=m.channelCount,C.audioDataRate=T.bitRate,C.hasVideo?C.videoCodec!=null&&(C.mimeType='video/x-flv; codecs="'+C.videoCodec+","+C.audioCodec+'"'):C.mimeType='video/x-flv; codecs="'+C.audioCodec+'"',C.isComplete()&&this._onMediaInfo(C)}var V=this._parseMP3AudioData(t,a+1,s-1,!1);if(V==null)return;var M=this._timestampBase+e,N={unit:V,length:V.byteLength,dts:M,pts:M};y.samples.push(N),y.length+=V.length}}},n.prototype._parseAACAudioData=function(t,a,s){if(s<=1){x.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var e={},f=new Uint8Array(t,a,s);return e.packetType=f[0],f[0]===0?e.data=this._parseAACAudioSpecificConfig(t,a+1,s-1):e.data=f.subarray(1),e},n.prototype._parseAACAudioSpecificConfig=function(t,a,s){var e=new Uint8Array(t,a,s),f=null,c=0,p=0,E=0,L=null;if(c=p=e[0]>>>3,E=(e[0]&7)<<1|e[1]>>>7,E<0||E>=this._mpegSamplingRates.length){this._onError(i.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var S=this._mpegSamplingRates[E],m=(e[1]&120)>>>3;if(m<0||m>=8){this._onError(i.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}c===5&&(L=(e[1]&7)<<1|e[2]>>>7,(e[2]&124)>>>2);var y=self.navigator.userAgent.toLowerCase();return y.indexOf("firefox")!==-1?E>=6?(c=5,f=new Array(4),L=E-3):(c=2,f=new Array(2),L=E):y.indexOf("android")!==-1?(c=2,f=new Array(2),L=E):(c=5,L=E,f=new Array(4),E>=6?L=E-3:m===1&&(c=2,f=new Array(2),L=E)),f[0]=c<<3,f[0]|=(E&15)>>>1,f[1]=(E&15)<<7,f[1]|=(m&15)<<3,c===5&&(f[1]|=(L&15)>>>1,f[2]=(L&1)<<7,f[2]|=2<<2,f[3]=0),{config:f,samplingRate:S,channelCount:m,codec:"mp4a.40."+c,originalCodec:"mp4a.40."+p}},n.prototype._parseMP3AudioData=function(t,a,s,e){if(s<4){x.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var f=new Uint8Array(t,a,s),c=null;if(e){if(f[0]!==255)return;var p=f[1]>>>3&3,E=(f[1]&6)>>1,L=(f[2]&240)>>>4,S=(f[2]&12)>>>2,m=f[3]>>>6&3,y=m!==3?2:1,A=0,T=0,C="mp3";switch(p){case 0:A=this._mpegAudioV25SampleRateTable[S];break;case 2:A=this._mpegAudioV20SampleRateTable[S];break;case 3:A=this._mpegAudioV10SampleRateTable[S];break}switch(E){case 1:L<this._mpegAudioL3BitRateTable.length&&(T=this._mpegAudioL3BitRateTable[L]);break;case 2:L<this._mpegAudioL2BitRateTable.length&&(T=this._mpegAudioL2BitRateTable[L]);break;case 3:L<this._mpegAudioL1BitRateTable.length&&(T=this._mpegAudioL1BitRateTable[L]);break}c={bitRate:T,samplingRate:A,channelCount:y,codec:C,originalCodec:C}}else c=f;return c},n.prototype._parseVideoData=function(t,a,s,e,f){if(s<=1){x.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var c=new Uint8Array(t,a,s)[0],p=(c&240)>>>4,E=c&15;if(E!==7){this._onError(i.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+E);return}this._parseAVCVideoPacket(t,a+1,s-1,e,f,p)}},n.prototype._parseAVCVideoPacket=function(t,a,s,e,f,c){if(s<4){x.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var p=this._littleEndian,E=new DataView(t,a,s),L=E.getUint8(0),S=E.getUint32(0,!p)&16777215,m=S<<8>>8;if(L===0)this._parseAVCDecoderConfigurationRecord(t,a+4,s-4);else if(L===1)this._parseAVCVideoData(t,a+4,s-4,e,f,c,m);else if(L!==2){this._onError(i.default.FORMAT_ERROR,"Flv: Invalid video packet type "+L);return}},n.prototype._parseAVCDecoderConfigurationRecord=function(t,a,s){if(s<7){x.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var e=this._videoMetadata,f=this._videoTrack,c=this._littleEndian,p=new DataView(t,a,s);e?typeof e.avcc<"u"&&x.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),e=this._videoMetadata={},e.type="video",e.id=f.id,e.timescale=this._timescale,e.duration=this._duration);var E=p.getUint8(0),L=p.getUint8(1);if(p.getUint8(2),p.getUint8(3),E!==1||L===0){this._onError(i.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(p.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(i.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var S=p.getUint8(5)&31;if(S===0){this._onError(i.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else S>1&&x.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+S);for(var m=6,y=0;y<S;y++){var A=p.getUint16(m,!c);if(m+=2,A!==0){var T=new Uint8Array(t,a+m,A);m+=A;var C=o.default.parseSPS(T);if(y===0){e.codecWidth=C.codec_size.width,e.codecHeight=C.codec_size.height,e.presentWidth=C.present_size.width,e.presentHeight=C.present_size.height,e.profile=C.profile_string,e.level=C.level_string,e.bitDepth=C.bit_depth,e.chromaFormat=C.chroma_format,e.sarRatio=C.sar_ratio,e.frameRate=C.frame_rate,(C.frame_rate.fixed===!1||C.frame_rate.fps_num===0||C.frame_rate.fps_den===0)&&(e.frameRate=this._referenceFrameRate);var M=e.frameRate.fps_den,K=e.frameRate.fps_num;e.refSampleDuration=e.timescale*(M/K);for(var V=T.subarray(1,4),N="avc1.",z=0;z<3;z++){var Q=V[z].toString(16);Q.length<2&&(Q="0"+Q),N+=Q}e.codec=N;var j=this._mediaInfo;j.width=e.codecWidth,j.height=e.codecHeight,j.fps=e.frameRate.fps,j.profile=e.profile,j.level=e.level,j.refFrames=C.ref_frames,j.chromaFormat=C.chroma_format_string,j.sarNum=e.sarRatio.width,j.sarDen=e.sarRatio.height,j.videoCodec=N,j.hasAudio?j.audioCodec!=null&&(j.mimeType='video/x-flv; codecs="'+j.videoCodec+","+j.audioCodec+'"'):j.mimeType='video/x-flv; codecs="'+j.videoCodec+'"',j.isComplete()&&this._onMediaInfo(j)}}}var $=p.getUint8(m);if($===0){this._onError(i.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else $>1&&x.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+$);m++;for(var y=0;y<$;y++){var A=p.getUint16(m,!c);m+=2,A!==0&&(m+=A)}e.avcc=new Uint8Array(s),e.avcc.set(new Uint8Array(t,a,s),0),x.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",e)},n.prototype._parseAVCVideoData=function(t,a,s,e,f,c,p){for(var E=this._littleEndian,L=new DataView(t,a,s),S=[],m=0,y=0,A=this._naluLengthSize,T=this._timestampBase+e,C=c===1;y<s;){if(y+4>=s){x.default.w(this.TAG,"Malformed Nalu near timestamp "+T+", offset = "+y+", dataSize = "+s);break}var M=L.getUint32(y,!E);if(A===3&&(M>>>=8),M>s-A){x.default.w(this.TAG,"Malformed Nalus near timestamp "+T+", NaluSize > DataSize!");return}var K=L.getUint8(y+A)&31;K===5&&(C=!0);var V=new Uint8Array(t,a+y,A+M),N={type:K,data:V};S.push(N),m+=V.byteLength,y+=A+M}if(S.length){var z=this._videoTrack,Q={units:S,length:m,isKeyframe:C,dts:T,cts:p,pts:T+p};C&&(Q.fileposition=f),z.samples.push(Q),z.length+=m}},n}();v.default=u},"./src/demux/sps-parser.js":function(O,v,_){_.r(v);var x=_("./src/demux/exp-golomb.js"),h=function(){function o(){}return o._ebsp2rbsp=function(i){for(var d=i,r=d.byteLength,l=new Uint8Array(r),u=0,n=0;n<r;n++)n>=2&&d[n]===3&&d[n-1]===0&&d[n-2]===0||(l[u]=d[n],u++);return new Uint8Array(l.buffer,0,u)},o.parseSPS=function(i){var d=o._ebsp2rbsp(i),r=new x.default(d);r.readByte();var l=r.readByte();r.readByte();var u=r.readByte();r.readUEG();var n=o.getProfileString(l),t=o.getLevelString(u),a=1,s=420,e=[0,420,422,444],f=8;if((l===100||l===110||l===122||l===244||l===44||l===83||l===86||l===118||l===128||l===138||l===144)&&(a=r.readUEG(),a===3&&r.readBits(1),a<=3&&(s=e[a]),f=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var c=a!==3?8:12,p=0;p<c;p++)r.readBool()&&(p<6?o._skipScalingList(r,16):o._skipScalingList(r,64));r.readUEG();var E=r.readUEG();if(E===0)r.readUEG();else if(E===1){r.readBits(1),r.readSEG(),r.readSEG();for(var L=r.readUEG(),p=0;p<L;p++)r.readSEG()}var S=r.readUEG();r.readBits(1);var m=r.readUEG(),y=r.readUEG(),A=r.readBits(1);A===0&&r.readBits(1),r.readBits(1);var T=0,C=0,M=0,K=0,V=r.readBool();V&&(T=r.readUEG(),C=r.readUEG(),M=r.readUEG(),K=r.readUEG());var N=1,z=1,Q=0,j=!0,$=0,fe=0,X=r.readBool();if(X){if(r.readBool()){var Z=r.readByte(),le=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],re=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Z>0&&Z<16?(N=le[Z-1],z=re[Z-1]):Z===255&&(N=r.readByte()<<8|r.readByte(),z=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var oe=r.readBits(32),pe=r.readBits(32);j=r.readBool(),$=pe,fe=oe*2,Q=$/fe}}var J=1;(N!==1||z!==1)&&(J=N/z);var U=0,ae=0;if(a===0)U=1,ae=2-A;else{var he=a===3?1:2,Ee=a===1?2:1;U=he,ae=Ee*(2-A)}var me=(m+1)*16,ge=(2-A)*((y+1)*16);me-=(T+C)*U,ge-=(M+K)*ae;var Se=Math.ceil(me*J);return r.destroy(),r=null,{profile_string:n,level_string:t,bit_depth:f,ref_frames:S,chroma_format:s,chroma_format_string:o.getChromaFormatString(s),frame_rate:{fixed:j,fps:Q,fps_den:fe,fps_num:$},sar_ratio:{width:N,height:z},codec_size:{width:me,height:ge},present_size:{width:Se,height:ge}}},o._skipScalingList=function(i,d){for(var r=8,l=8,u=0,n=0;n<d;n++)l!==0&&(u=i.readSEG(),l=(r+u+256)%256),r=l===0?r:l},o.getProfileString=function(i){switch(i){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},o.getLevelString=function(i){return(i/10).toFixed(1)},o.getChromaFormatString=function(i){switch(i){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},o}();v.default=h},"./src/flv.js":function(O,v,_){_.r(v);var x=_("./src/utils/polyfill.js"),h=_("./src/core/features.js"),o=_("./src/io/loader.js"),i=_("./src/player/flv-player.js"),d=_("./src/player/native-player.js"),r=_("./src/player/player-events.js"),l=_("./src/player/player-errors.js"),u=_("./src/utils/logging-control.js"),n=_("./src/utils/exception.js");x.default.install();function t(f,c){var p=f;if(p==null||typeof p!="object")throw new n.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!p.hasOwnProperty("type"))throw new n.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(p.type){case"flv":return new i.default(p,c);default:return new d.default(p,c)}}function a(){return h.default.supportMSEH264Playback()}function s(){return h.default.getFeatureList()}var e={};e.createPlayer=t,e.isSupported=a,e.getFeatureList=s,e.BaseLoader=o.BaseLoader,e.LoaderStatus=o.LoaderStatus,e.LoaderErrors=o.LoaderErrors,e.Events=r.default,e.ErrorTypes=l.ErrorTypes,e.ErrorDetails=l.ErrorDetails,e.FlvPlayer=i.default,e.NativePlayer=d.default,e.LoggingControl=u.default,Object.defineProperty(e,"version",{enumerable:!0,get:function(){return"1.6.2"}}),v.default=e},"./src/index.js":function(O,v,_){O.exports=_("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(O,v,_){_.r(v);var x=_("./src/utils/browser.js"),h=_("./src/io/loader.js"),o=_("./src/utils/exception.js"),i=function(){var r=function(l,u){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])},r(l,u)};return function(l,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");r(l,u);function n(){this.constructor=l}l.prototype=u===null?Object.create(u):(n.prototype=u.prototype,new n)}}(),d=function(r){i(l,r);function l(u,n){var t=r.call(this,"fetch-stream-loader")||this;return t.TAG="FetchStreamLoader",t._seekHandler=u,t._config=n,t._needStash=!0,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return l.isSupported=function(){try{var u=x.default.msedge&&x.default.version.minor>=15048,n=x.default.msedge?u:!0;return self.fetch&&self.ReadableStream&&n}catch{return!1}},l.prototype.destroy=function(){this.isWorking()&&this.abort(),r.prototype.destroy.call(this)},l.prototype.open=function(u,n){var t=this;this._dataSource=u,this._range=n;var a=u.url;this._config.reuseRedirectedURL&&u.redirectedURL!=null&&(a=u.redirectedURL);var s=this._seekHandler.getConfig(a,n),e=new self.Headers;if(typeof s.headers=="object"){var f=s.headers;for(var c in f)f.hasOwnProperty(c)&&e.append(c,f[c])}var p={method:"GET",headers:e,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var c in this._config.headers)e.append(c,this._config.headers[c]);u.cors===!1&&(p.mode="same-origin"),u.withCredentials&&(p.credentials="include"),u.referrerPolicy&&(p.referrerPolicy=u.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,p.signal=this._abortController.signal),this._status=h.LoaderStatus.kConnecting,self.fetch(s.url,p).then(function(E){if(t._requestAbort){t._status=h.LoaderStatus.kIdle,E.body.cancel();return}if(E.ok&&E.status>=200&&E.status<=299){if(E.url!==s.url&&t._onURLRedirect){var L=t._seekHandler.removeURLParameters(E.url);t._onURLRedirect(L)}var S=E.headers.get("Content-Length");return S!=null&&(t._contentLength=parseInt(S),t._contentLength!==0&&t._onContentLengthKnown&&t._onContentLengthKnown(t._contentLength)),t._pump.call(t,E.body.getReader())}else if(t._status=h.LoaderStatus.kError,t._onError)t._onError(h.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:E.status,msg:E.statusText});else throw new o.RuntimeException("FetchStreamLoader: Http code invalid, "+E.status+" "+E.statusText)}).catch(function(E){if(!(t._abortController&&t._abortController.signal.aborted))if(t._status=h.LoaderStatus.kError,t._onError)t._onError(h.LoaderErrors.EXCEPTION,{code:-1,msg:E.message});else throw E})},l.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==h.LoaderStatus.kBuffering||!x.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},l.prototype._pump=function(u){var n=this;return u.read().then(function(t){if(t.done)if(n._contentLength!==null&&n._receivedLength<n._contentLength){n._status=h.LoaderStatus.kError;var a=h.LoaderErrors.EARLY_EOF,s={code:-1,msg:"Fetch stream meet Early-EOF"};if(n._onError)n._onError(a,s);else throw new o.RuntimeException(s.msg)}else n._status=h.LoaderStatus.kComplete,n._onComplete&&n._onComplete(n._range.from,n._range.from+n._receivedLength-1);else{if(n._abortController&&n._abortController.signal.aborted){n._status=h.LoaderStatus.kComplete;return}else if(n._requestAbort===!0)return n._status=h.LoaderStatus.kComplete,u.cancel();n._status=h.LoaderStatus.kBuffering;var e=t.value.buffer,f=n._range.from+n._receivedLength;n._receivedLength+=e.byteLength,n._onDataArrival&&n._onDataArrival(e,f,n._receivedLength),n._pump(u)}}).catch(function(t){if(n._abortController&&n._abortController.signal.aborted){n._status=h.LoaderStatus.kComplete;return}if(!(t.code===11&&x.default.msedge)){n._status=h.LoaderStatus.kError;var a=0,s=null;if((t.code===19||t.message==="network error")&&(n._contentLength===null||n._contentLength!==null&&n._receivedLength<n._contentLength)?(a=h.LoaderErrors.EARLY_EOF,s={code:t.code,msg:"Fetch stream meet Early-EOF"}):(a=h.LoaderErrors.EXCEPTION,s={code:t.code,msg:t.message}),n._onError)n._onError(a,s);else throw new o.RuntimeException(s.msg)}})},l}(h.BaseLoader);v.default=d},"./src/io/io-controller.js":function(O,v,_){_.r(v);var x=_("./src/utils/logger.js"),h=_("./src/io/speed-sampler.js"),o=_("./src/io/loader.js"),i=_("./src/io/fetch-stream-loader.js"),d=_("./src/io/xhr-moz-chunked-loader.js"),r=_("./src/io/xhr-range-loader.js"),l=_("./src/io/websocket-loader.js"),u=_("./src/io/range-seek-handler.js"),n=_("./src/io/param-seek-handler.js"),t=_("./src/utils/exception.js"),a=function(){function s(e,f,c){this.TAG="IOController",this._config=f,this._extraData=c,this._stashInitialSize=1024*384,f.stashInitialSize!=null&&f.stashInitialSize>0&&(this._stashInitialSize=f.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,f.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=e,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url),this._refTotalLength=e.filesize?e.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new h.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return s.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},s.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},s.prototype.isPaused=function(){return this._paused},Object.defineProperty(s.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"extraData",{get:function(){return this._extraData},set:function(e){this._extraData=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(e){this._onSeeked=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(e){this._onRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"currentSpeed",{get:function(){return this._loaderClass===r.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),s.prototype._selectSeekHandler=function(){var e=this._config;if(e.seekType==="range")this._seekHandler=new u.default(this._config.rangeLoadZeroStart);else if(e.seekType==="param"){var f=e.seekParamStart||"bstart",c=e.seekParamEnd||"bend";this._seekHandler=new n.default(f,c)}else if(e.seekType==="custom"){if(typeof e.customSeekHandler!="function")throw new t.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}else throw new t.InvalidArgumentException("Invalid seekType in config: "+e.seekType)},s.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=l.default;else if(i.default.isSupported())this._loaderClass=i.default;else if(d.default.isSupported())this._loaderClass=d.default;else if(r.default.isSupported())this._loaderClass=r.default;else throw new t.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},s.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},s.prototype.open=function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},s.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},s.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},s.prototype.resume=function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}},s.prototype.seek=function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)},s.prototype._internalSeek=function(e,f){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(f),this._loader.destroy(),this._loader=null;var c={from:e,to:-1};this._currentRange={from:c.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,c),this._onSeeked&&this._onSeeked()},s.prototype.updateUrl=function(e){if(!e||typeof e!="string"||e.length===0)throw new t.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=e},s.prototype._expandBuffer=function(e){for(var f=this._stashSize;f+1024*1024*1<e;)f*=2;if(f+=1024*1024*1,f!==this._bufferSize){var c=new ArrayBuffer(f);if(this._stashUsed>0){var p=new Uint8Array(this._stashBuffer,0,this._stashUsed),E=new Uint8Array(c,0,f);E.set(p,0)}this._stashBuffer=c,this._bufferSize=f}},s.prototype._normalizeSpeed=function(e){var f=this._speedNormalizeList,c=f.length-1,p=0,E=0,L=c;if(e<f[0])return f[0];for(;E<=L;){if(p=E+Math.floor((L-E)/2),p===c||e>=f[p]&&e<f[p+1])return f[p];f[p]<e?E=p+1:L=p-1}},s.prototype._adjustStashSize=function(e){var f=0;this._config.isLive||e<512?f=e:e>=512&&e<=1024?f=Math.floor(e*1.5):f=e*2,f>8192&&(f=8192);var c=f*1024+1024*1024*1;this._bufferSize<c&&this._expandBuffer(c),this._stashSize=f*1024},s.prototype._dispatchChunks=function(e,f){return this._currentRange.to=f+e.byteLength-1,this._onDataArrival(e,f)},s.prototype._onURLRedirect=function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)},s.prototype._onContentLengthKnown=function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)},s.prototype._onLoaderChunkArrival=function(e,f,c){if(!this._onDataArrival)throw new t.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var p=this._speedSampler.lastSecondKBps;if(p!==0){var E=this._normalizeSpeed(p);this._speedNormalized!==E&&(this._speedNormalized=E,this._adjustStashSize(E))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=f),this._stashUsed+e.byteLength<=this._stashSize){var m=new Uint8Array(this._stashBuffer,0,this._stashSize);m.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var A=this._stashBuffer.slice(0,this._stashUsed),L=this._dispatchChunks(A,this._stashByteStart);if(L<A.byteLength){if(L>0){var y=new Uint8Array(A,L);m.set(y,0),this._stashUsed=y.byteLength,this._stashByteStart+=L}}else this._stashUsed=0,this._stashByteStart+=L;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),m=new Uint8Array(this._stashBuffer,0,this._bufferSize)),m.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var L=this._dispatchChunks(e,f);if(L<e.byteLength){var S=e.byteLength-L;S>this._bufferSize&&(this._expandBuffer(S),m=new Uint8Array(this._stashBuffer,0,this._bufferSize)),m.set(new Uint8Array(e,L),0),this._stashUsed+=S,this._stashByteStart=f+L}}}else if(this._stashUsed===0){var L=this._dispatchChunks(e,f);if(L<e.byteLength){var S=e.byteLength-L;S>this._bufferSize&&this._expandBuffer(S);var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);m.set(new Uint8Array(e,L),0),this._stashUsed+=S,this._stashByteStart=f+L}}else{this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength);var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);m.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;var L=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(L<this._stashUsed&&L>0){var y=new Uint8Array(this._stashBuffer,L);m.set(y,0)}this._stashUsed-=L,this._stashByteStart+=L}}},s.prototype._flushStashBuffer=function(e){if(this._stashUsed>0){var f=this._stashBuffer.slice(0,this._stashUsed),c=this._dispatchChunks(f,this._stashByteStart),p=f.byteLength-c;if(c<f.byteLength)if(e)x.default.w(this.TAG,p+" bytes unconsumed data remain when flush buffer, dropped");else{if(c>0){var E=new Uint8Array(this._stashBuffer,0,this._bufferSize),L=new Uint8Array(f,c);E.set(L,0),this._stashUsed=L.byteLength,this._stashByteStart+=c}return 0}return this._stashUsed=0,this._stashByteStart=0,p}return 0},s.prototype._onLoaderComplete=function(e,f){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},s.prototype._onLoaderError=function(e,f){switch(x.default.e(this.TAG,"Loader error, code = "+f.code+", msg = "+f.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF),e){case o.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var c=this._currentRange.to+1;c<this._totalLength&&(x.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(c,!1));return}e=o.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case o.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case o.LoaderErrors.CONNECTING_TIMEOUT:case o.LoaderErrors.HTTP_STATUS_CODE_INVALID:case o.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(e,f);else throw new t.RuntimeException("IOException: "+f.msg)},s}();v.default=a},"./src/io/loader.js":function(O,v,_){_.r(v),_.d(v,{LoaderStatus:function(){return h},LoaderErrors:function(){return o},BaseLoader:function(){return i}});var x=_("./src/utils/exception.js"),h={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},o={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},i=function(){function d(r){this._type=r||"undefined",this._status=h.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return d.prototype.destroy=function(){this._status=h.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},d.prototype.isWorking=function(){return this._status===h.kConnecting||this._status===h.kBuffering},Object.defineProperty(d.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(r){this._onContentLengthKnown=r},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(r){this._onURLRedirect=r},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(r){this._onDataArrival=r},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onError",{get:function(){return this._onError},set:function(r){this._onError=r},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onComplete",{get:function(){return this._onComplete},set:function(r){this._onComplete=r},enumerable:!1,configurable:!0}),d.prototype.open=function(r,l){throw new x.NotImplementedException("Unimplemented abstract function!")},d.prototype.abort=function(){throw new x.NotImplementedException("Unimplemented abstract function!")},d}()},"./src/io/param-seek-handler.js":function(O,v,_){_.r(v);var x=function(){function h(o,i){this._startName=o,this._endName=i}return h.prototype.getConfig=function(o,i){var d=o;if(i.from!==0||i.to!==-1){var r=!0;d.indexOf("?")===-1&&(d+="?",r=!1),r&&(d+="&"),d+=this._startName+"="+i.from.toString(),i.to!==-1&&(d+="&"+this._endName+"="+i.to.toString())}return{url:d,headers:{}}},h.prototype.removeURLParameters=function(o){var i=o.split("?")[0],d=void 0,r=o.indexOf("?");r!==-1&&(d=o.substring(r+1));var l="";if(d!=null&&d.length>0)for(var u=d.split("&"),n=0;n<u.length;n++){var t=u[n].split("="),a=n>0;t[0]!==this._startName&&t[0]!==this._endName&&(a&&(l+="&"),l+=u[n])}return l.length===0?i:i+"?"+l},h}();v.default=x},"./src/io/range-seek-handler.js":function(O,v,_){_.r(v);var x=function(){function h(o){this._zeroStart=o||!1}return h.prototype.getConfig=function(o,i){var d={};if(i.from!==0||i.to!==-1){var r=void 0;i.to!==-1?r="bytes="+i.from.toString()+"-"+i.to.toString():r="bytes="+i.from.toString()+"-",d.Range=r}else this._zeroStart&&(d.Range="bytes=0-");return{url:o,headers:d}},h.prototype.removeURLParameters=function(o){return o},h}();v.default=x},"./src/io/speed-sampler.js":function(O,v,_){_.r(v);var x=function(){function h(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return h.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},h.prototype.addBytes=function(o){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=o,this._totalBytes+=o):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=o,this._totalBytes+=o):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=o,this._totalBytes+=o,this._lastCheckpoint=this._now())},Object.defineProperty(h.prototype,"currentKBps",{get:function(){this.addBytes(0);var o=(this._now()-this._lastCheckpoint)/1e3;return o==0&&(o=1),this._intervalBytes/o/1024},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"averageKBps",{get:function(){var o=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/o/1024},enumerable:!1,configurable:!0}),h}();v.default=x},"./src/io/websocket-loader.js":function(O,v,_){_.r(v);var x=_("./src/io/loader.js"),h=_("./src/utils/exception.js"),o=function(){var d=function(r,l){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,n){u.__proto__=n}||function(u,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(u[t]=n[t])},d(r,l)};return function(r,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");d(r,l);function u(){this.constructor=r}r.prototype=l===null?Object.create(l):(u.prototype=l.prototype,new u)}}(),i=function(d){o(r,d);function r(){var l=d.call(this,"websocket-loader")||this;return l.TAG="WebSocketLoader",l._needStash=!0,l._ws=null,l._requestAbort=!1,l._receivedLength=0,l}return r.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},r.prototype.destroy=function(){this._ws&&this.abort(),d.prototype.destroy.call(this)},r.prototype.open=function(l){try{var u=this._ws=new self.WebSocket(l.url);u.binaryType="arraybuffer",u.onopen=this._onWebSocketOpen.bind(this),u.onclose=this._onWebSocketClose.bind(this),u.onmessage=this._onWebSocketMessage.bind(this),u.onerror=this._onWebSocketError.bind(this),this._status=x.LoaderStatus.kConnecting}catch(t){this._status=x.LoaderStatus.kError;var n={code:t.code,msg:t.message};if(this._onError)this._onError(x.LoaderErrors.EXCEPTION,n);else throw new h.RuntimeException(n.msg)}},r.prototype.abort=function(){var l=this._ws;l&&(l.readyState===0||l.readyState===1)&&(this._requestAbort=!0,l.close()),this._ws=null,this._status=x.LoaderStatus.kComplete},r.prototype._onWebSocketOpen=function(l){this._status=x.LoaderStatus.kBuffering},r.prototype._onWebSocketClose=function(l){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=x.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},r.prototype._onWebSocketMessage=function(l){var u=this;if(l.data instanceof ArrayBuffer)this._dispatchArrayBuffer(l.data);else if(l.data instanceof Blob){var n=new FileReader;n.onload=function(){u._dispatchArrayBuffer(n.result)},n.readAsArrayBuffer(l.data)}else{this._status=x.LoaderStatus.kError;var t={code:-1,msg:"Unsupported WebSocket message type: "+l.data.constructor.name};if(this._onError)this._onError(x.LoaderErrors.EXCEPTION,t);else throw new h.RuntimeException(t.msg)}},r.prototype._dispatchArrayBuffer=function(l){var u=l,n=this._receivedLength;this._receivedLength+=u.byteLength,this._onDataArrival&&this._onDataArrival(u,n,this._receivedLength)},r.prototype._onWebSocketError=function(l){this._status=x.LoaderStatus.kError;var u={code:l.code,msg:l.message};if(this._onError)this._onError(x.LoaderErrors.EXCEPTION,u);else throw new h.RuntimeException(u.msg)},r}(x.BaseLoader);v.default=i},"./src/io/xhr-moz-chunked-loader.js":function(O,v,_){_.r(v);var x=_("./src/utils/logger.js"),h=_("./src/io/loader.js"),o=_("./src/utils/exception.js"),i=function(){var r=function(l,u){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])},r(l,u)};return function(l,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");r(l,u);function n(){this.constructor=l}l.prototype=u===null?Object.create(u):(n.prototype=u.prototype,new n)}}(),d=function(r){i(l,r);function l(u,n){var t=r.call(this,"xhr-moz-chunked-loader")||this;return t.TAG="MozChunkedLoader",t._seekHandler=u,t._config=n,t._needStash=!0,t._xhr=null,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return l.isSupported=function(){try{var u=new XMLHttpRequest;return u.open("GET","https://example.com",!0),u.responseType="moz-chunked-arraybuffer",u.responseType==="moz-chunked-arraybuffer"}catch(n){return x.default.w("MozChunkedLoader",n.message),!1}},l.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),r.prototype.destroy.call(this)},l.prototype.open=function(u,n){this._dataSource=u,this._range=n;var t=u.url;this._config.reuseRedirectedURL&&u.redirectedURL!=null&&(t=u.redirectedURL);var a=this._seekHandler.getConfig(t,n);this._requestURL=a.url;var s=this._xhr=new XMLHttpRequest;if(s.open("GET",a.url,!0),s.responseType="moz-chunked-arraybuffer",s.onreadystatechange=this._onReadyStateChange.bind(this),s.onprogress=this._onProgress.bind(this),s.onloadend=this._onLoadEnd.bind(this),s.onerror=this._onXhrError.bind(this),u.withCredentials&&(s.withCredentials=!0),typeof a.headers=="object"){var e=a.headers;for(var f in e)e.hasOwnProperty(f)&&s.setRequestHeader(f,e[f])}if(typeof this._config.headers=="object"){var e=this._config.headers;for(var f in e)e.hasOwnProperty(f)&&s.setRequestHeader(f,e[f])}this._status=h.LoaderStatus.kConnecting,s.send()},l.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=h.LoaderStatus.kComplete},l.prototype._onReadyStateChange=function(u){var n=u.target;if(n.readyState===2){if(n.responseURL!=null&&n.responseURL!==this._requestURL&&this._onURLRedirect){var t=this._seekHandler.removeURLParameters(n.responseURL);this._onURLRedirect(t)}if(n.status!==0&&(n.status<200||n.status>299))if(this._status=h.LoaderStatus.kError,this._onError)this._onError(h.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:n.status,msg:n.statusText});else throw new o.RuntimeException("MozChunkedLoader: Http code invalid, "+n.status+" "+n.statusText);else this._status=h.LoaderStatus.kBuffering}},l.prototype._onProgress=function(u){if(this._status!==h.LoaderStatus.kError){this._contentLength===null&&u.total!==null&&u.total!==0&&(this._contentLength=u.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var n=u.target.response,t=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength,this._onDataArrival&&this._onDataArrival(n,t,this._receivedLength)}},l.prototype._onLoadEnd=function(u){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===h.LoaderStatus.kError)return;this._status=h.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},l.prototype._onXhrError=function(u){this._status=h.LoaderStatus.kError;var n=0,t=null;if(this._contentLength&&u.loaded<this._contentLength?(n=h.LoaderErrors.EARLY_EOF,t={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(n=h.LoaderErrors.EXCEPTION,t={code:-1,msg:u.constructor.name+" "+u.type}),this._onError)this._onError(n,t);else throw new o.RuntimeException(t.msg)},l}(h.BaseLoader);v.default=d},"./src/io/xhr-range-loader.js":function(O,v,_){_.r(v);var x=_("./src/utils/logger.js"),h=_("./src/io/speed-sampler.js"),o=_("./src/io/loader.js"),i=_("./src/utils/exception.js"),d=function(){var l=function(u,n){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,a){t.__proto__=a}||function(t,a){for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(t[s]=a[s])},l(u,n)};return function(u,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");l(u,n);function t(){this.constructor=u}u.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}}(),r=function(l){d(u,l);function u(n,t){var a=l.call(this,"xhr-range-loader")||this;return a.TAG="RangeLoader",a._seekHandler=n,a._config=t,a._needStash=!1,a._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],a._currentChunkSizeKB=384,a._currentSpeedNormalized=0,a._zeroSpeedChunkCount=0,a._xhr=null,a._speedSampler=new h.default,a._requestAbort=!1,a._waitForTotalLength=!1,a._totalLengthReceived=!1,a._currentRequestURL=null,a._currentRedirectedURL=null,a._currentRequestRange=null,a._totalLength=null,a._contentLength=null,a._receivedLength=0,a._lastTimeLoaded=0,a}return u.isSupported=function(){try{var n=new XMLHttpRequest;return n.open("GET","https://example.com",!0),n.responseType="arraybuffer",n.responseType==="arraybuffer"}catch(t){return x.default.w("RangeLoader",t.message),!1}},u.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),l.prototype.destroy.call(this)},Object.defineProperty(u.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),u.prototype.open=function(n,t){this._dataSource=n,this._range=t,this._status=o.LoaderStatus.kConnecting;var a=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(a=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!a?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},u.prototype._openSubRange=function(){var n=this._currentChunkSizeKB*1024,t=this._range.from+this._receivedLength,a=t+n;this._contentLength!=null&&a-this._range.from>=this._contentLength&&(a=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:a},this._internalOpen(this._dataSource,this._currentRequestRange)},u.prototype._internalOpen=function(n,t){this._lastTimeLoaded=0;var a=n.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?a=this._currentRedirectedURL:n.redirectedURL!=null&&(a=n.redirectedURL));var s=this._seekHandler.getConfig(a,t);this._currentRequestURL=s.url;var e=this._xhr=new XMLHttpRequest;if(e.open("GET",s.url,!0),e.responseType="arraybuffer",e.onreadystatechange=this._onReadyStateChange.bind(this),e.onprogress=this._onProgress.bind(this),e.onload=this._onLoad.bind(this),e.onerror=this._onXhrError.bind(this),n.withCredentials&&(e.withCredentials=!0),typeof s.headers=="object"){var f=s.headers;for(var c in f)f.hasOwnProperty(c)&&e.setRequestHeader(c,f[c])}if(typeof this._config.headers=="object"){var f=this._config.headers;for(var c in f)f.hasOwnProperty(c)&&e.setRequestHeader(c,f[c])}e.send()},u.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=o.LoaderStatus.kComplete},u.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},u.prototype._onReadyStateChange=function(n){var t=n.target;if(t.readyState===2){if(t.responseURL!=null){var a=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&a!==this._currentRedirectedURL&&(this._currentRedirectedURL=a,this._onURLRedirect&&this._onURLRedirect(a))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=o.LoaderStatus.kBuffering}else if(this._status=o.LoaderStatus.kError,this._onError)this._onError(o.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText});else throw new i.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText)}},u.prototype._onProgress=function(n){if(this._status!==o.LoaderStatus.kError){if(this._contentLength===null){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var a=n.total;this._internalAbort(),a!=null&a!==0&&(this._totalLength=a)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var s=n.loaded-this._lastTimeLoaded;this._lastTimeLoaded=n.loaded,this._speedSampler.addBytes(s)}},u.prototype._normalizeSpeed=function(n){var t=this._chunkSizeKBList,a=t.length-1,s=0,e=0,f=a;if(n<t[0])return t[0];for(;e<=f;){if(s=e+Math.floor((f-e)/2),s===a||n>=t[s]&&n<t[s+1])return t[s];t[s]<n?e=s+1:f=s-1}},u.prototype._onLoad=function(n){if(this._status!==o.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(t===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),t!==0){var a=this._normalizeSpeed(t);this._currentSpeedNormalized!==a&&(this._currentSpeedNormalized=a,this._currentChunkSizeKB=a)}var s=n.target.response,e=this._range.from+this._receivedLength;this._receivedLength+=s.byteLength;var f=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():f=!0,this._onDataArrival&&this._onDataArrival(s,e,this._receivedLength),f&&(this._status=o.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},u.prototype._onXhrError=function(n){this._status=o.LoaderStatus.kError;var t=0,a=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=o.LoaderErrors.EARLY_EOF,a={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=o.LoaderErrors.EXCEPTION,a={code:-1,msg:n.constructor.name+" "+n.type}),this._onError)this._onError(t,a);else throw new i.RuntimeException(a.msg)},u}(o.BaseLoader);v.default=r},"./src/player/flv-player.js":function(O,v,_){_.r(v);var x=_("./node_modules/events/events.js"),h=_.n(x),o=_("./src/utils/logger.js"),i=_("./src/utils/browser.js"),d=_("./src/player/player-events.js"),r=_("./src/core/transmuxer.js"),l=_("./src/core/transmuxing-events.js"),u=_("./src/core/mse-controller.js"),n=_("./src/core/mse-events.js"),t=_("./src/player/player-errors.js"),a=_("./src/config.js"),s=_("./src/utils/exception.js"),e=function(){function f(c,p){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(h()),this._config=(0,a.createDefaultConfig)(),typeof p=="object"&&Object.assign(this._config,p),c.type.toLowerCase()!=="flv")throw new s.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");c.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=c,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var E=i.default.chrome&&(i.default.version.major<50||i.default.version.major===50&&i.default.version.build<2661);this._alwaysSeekKeyframe=!!(E||i.default.msedge||i.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return f.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},f.prototype.on=function(c,p){var E=this;c===d.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){E._emitter.emit(d.default.MEDIA_INFO,E.mediaInfo)}):c===d.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){E._emitter.emit(d.default.STATISTICS_INFO,E.statisticsInfo)}),this._emitter.addListener(c,p)},f.prototype.off=function(c,p){this._emitter.removeListener(c,p)},f.prototype.attachMediaElement=function(c){var p=this;if(this._mediaElement=c,c.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),c.addEventListener("seeking",this.e.onvSeeking),c.addEventListener("canplay",this.e.onvCanPlay),c.addEventListener("stalled",this.e.onvStalled),c.addEventListener("progress",this.e.onvProgress),this._msectl=new u.default(this._config),this._msectl.on(n.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(n.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(n.default.SOURCE_OPEN,function(){p._mseSourceOpened=!0,p._hasPendingLoad&&(p._hasPendingLoad=!1,p.load())}),this._msectl.on(n.default.ERROR,function(E){p._emitter.emit(d.default.ERROR,t.ErrorTypes.MEDIA_ERROR,t.ErrorDetails.MEDIA_MSE_ERROR,E)}),this._msectl.attachMediaElement(c),this._pendingSeekTime!=null)try{c.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},f.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},f.prototype.load=function(){var c=this;if(!this._mediaElement)throw new s.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new s.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new r.default(this._mediaDataSource,this._config),this._transmuxer.on(l.default.INIT_SEGMENT,function(p,E){c._msectl.appendInitSegment(E)}),this._transmuxer.on(l.default.MEDIA_SEGMENT,function(p,E){if(c._msectl.appendMediaSegment(E),c._config.lazyLoad&&!c._config.isLive){var L=c._mediaElement.currentTime;E.info.endDts>=(L+c._config.lazyLoadMaxDuration)*1e3&&c._progressChecker==null&&(o.default.v(c.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),c._suspendTransmuxer())}}),this._transmuxer.on(l.default.LOADING_COMPLETE,function(){c._msectl.endOfStream(),c._emitter.emit(d.default.LOADING_COMPLETE)}),this._transmuxer.on(l.default.RECOVERED_EARLY_EOF,function(){c._emitter.emit(d.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(l.default.IO_ERROR,function(p,E){c._emitter.emit(d.default.ERROR,t.ErrorTypes.NETWORK_ERROR,p,E)}),this._transmuxer.on(l.default.DEMUX_ERROR,function(p,E){c._emitter.emit(d.default.ERROR,t.ErrorTypes.MEDIA_ERROR,p,{code:-1,msg:E})}),this._transmuxer.on(l.default.MEDIA_INFO,function(p){c._mediaInfo=p,c._emitter.emit(d.default.MEDIA_INFO,Object.assign({},p))}),this._transmuxer.on(l.default.METADATA_ARRIVED,function(p){c._emitter.emit(d.default.METADATA_ARRIVED,p)}),this._transmuxer.on(l.default.SCRIPTDATA_ARRIVED,function(p){c._emitter.emit(d.default.SCRIPTDATA_ARRIVED,p)}),this._transmuxer.on(l.default.STATISTICS_INFO,function(p){c._statisticsInfo=c._fillStatisticsInfo(p),c._emitter.emit(d.default.STATISTICS_INFO,Object.assign({},c._statisticsInfo))}),this._transmuxer.on(l.default.RECOMMEND_SEEKPOINT,function(p){c._mediaElement&&!c._config.accurateSeek&&(c._requestSetTime=!0,c._mediaElement.currentTime=p/1e3)}),this._transmuxer.open()}},f.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},f.prototype.play=function(){return this._mediaElement.play()},f.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(c){this._mediaElement.volume=c},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(c){this._mediaElement.muted=c},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(c){this._mediaElement?this._internalSeek(c):this._pendingSeekTime=c},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),f.prototype._fillStatisticsInfo=function(c){if(c.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return c;var p=!0,E=0,L=0;if(this._mediaElement.getVideoPlaybackQuality){var S=this._mediaElement.getVideoPlaybackQuality();E=S.totalVideoFrames,L=S.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(E=this._mediaElement.webkitDecodedFrameCount,L=this._mediaElement.webkitDroppedFrameCount):p=!1;return p&&(c.decodedFrames=E,c.droppedFrames=L),c},f.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var c=this._mediaElement.buffered,p=this._mediaElement.currentTime,E=0,L=0;L<c.length;L++){var S=c.start(L),m=c.end(L);if(S<=p&&p<m){E=m;break}}E>=p+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(o.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},f.prototype._onmseBufferFull=function(){o.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},f.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},f.prototype._checkProgressAndResume=function(){for(var c=this._mediaElement.currentTime,p=this._mediaElement.buffered,E=!1,L=0;L<p.length;L++){var S=p.start(L),m=p.end(L);if(c>=S&&c<m){c>=m-this._config.lazyLoadRecoverDuration&&(E=!0);break}}E&&(window.clearInterval(this._progressChecker),this._progressChecker=null,E&&(o.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},f.prototype._isTimepointBuffered=function(c){for(var p=this._mediaElement.buffered,E=0;E<p.length;E++){var L=p.start(E),S=p.end(E);if(c>=L&&c<S)return!0}return!1},f.prototype._internalSeek=function(c){var p=this._isTimepointBuffered(c),E=!1,L=0;if(c<1&&this._mediaElement.buffered.length>0){var S=this._mediaElement.buffered.start(0);(S<1&&c<S||i.default.safari)&&(E=!0,L=i.default.safari?.1:S)}if(E)this._requestSetTime=!0,this._mediaElement.currentTime=L;else if(p){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=c;else{var m=this._msectl.getNearestKeyframe(Math.floor(c*1e3));this._requestSetTime=!0,m!=null?this._mediaElement.currentTime=m.dts/1e3:this._mediaElement.currentTime=c}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(c),this._transmuxer.seek(Math.floor(c*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=c)},f.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var c=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(c)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(c),this._transmuxer.seek(Math.floor(c*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=c))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},f.prototype._checkAndResumeStuckPlayback=function(c){var p=this._mediaElement;if(c||!this._receivedCanPlay||p.readyState<2){var E=p.buffered;E.length>0&&p.currentTime<E.start(0)&&(o.default.w(this.TAG,"Playback seems stuck at "+p.currentTime+", seek to "+E.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=E.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},f.prototype._onvLoadedMetadata=function(c){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},f.prototype._onvSeeking=function(c){var p=this._mediaElement.currentTime,E=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(p<1&&E.length>0){var L=E.start(0);if(L<1&&p<L||i.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=i.default.safari?.1:L;return}}if(this._isTimepointBuffered(p)){if(this._alwaysSeekKeyframe){var S=this._msectl.getNearestKeyframe(Math.floor(p*1e3));S!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=S.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:p,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},f.prototype._onvCanPlay=function(c){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},f.prototype._onvStalled=function(c){this._checkAndResumeStuckPlayback(!0)},f.prototype._onvProgress=function(c){this._checkAndResumeStuckPlayback()},f}();v.default=e},"./src/player/native-player.js":function(O,v,_){_.r(v);var x=_("./node_modules/events/events.js"),h=_.n(x),o=_("./src/player/player-events.js"),i=_("./src/config.js"),d=_("./src/utils/exception.js"),r=function(){function l(u,n){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(h()),this._config=(0,i.createDefaultConfig)(),typeof n=="object"&&Object.assign(this._config,n),u.type.toLowerCase()==="flv")throw new d.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(u.hasOwnProperty("segments"))throw new d.InvalidArgumentException("NativePlayer("+u.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=u,this._mediaElement=null}return l.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},l.prototype.on=function(u,n){var t=this;u===o.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(o.default.MEDIA_INFO,t.mediaInfo)}):u===o.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(o.default.STATISTICS_INFO,t.statisticsInfo)}),this._emitter.addListener(u,n)},l.prototype.off=function(u,n){this._emitter.removeListener(u,n)},l.prototype.attachMediaElement=function(u){if(this._mediaElement=u,u.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{u.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},l.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},l.prototype.load=function(){if(!this._mediaElement)throw new d.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},l.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},l.prototype.play=function(){return this._mediaElement.play()},l.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(u){this._mediaElement.volume=u},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(u){this._mediaElement.muted=u},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(u){this._mediaElement?this._mediaElement.currentTime=u:this._pendingSeekTime=u},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"mediaInfo",{get:function(){var u=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",n={mimeType:u+this._mediaDataSource.type};return this._mediaElement&&(n.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(n.width=this._mediaElement.videoWidth,n.height=this._mediaElement.videoHeight)),n},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"statisticsInfo",{get:function(){var u={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return u;var n=!0,t=0,a=0;if(this._mediaElement.getVideoPlaybackQuality){var s=this._mediaElement.getVideoPlaybackQuality();t=s.totalVideoFrames,a=s.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(t=this._mediaElement.webkitDecodedFrameCount,a=this._mediaElement.webkitDroppedFrameCount):n=!1;return n&&(u.decodedFrames=t,u.droppedFrames=a),u},enumerable:!1,configurable:!0}),l.prototype._onvLoadedMetadata=function(u){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(o.default.MEDIA_INFO,this.mediaInfo)},l.prototype._reportStatisticsInfo=function(){this._emitter.emit(o.default.STATISTICS_INFO,this.statisticsInfo)},l}();v.default=r},"./src/player/player-errors.js":function(O,v,_){_.r(v),_.d(v,{ErrorTypes:function(){return o},ErrorDetails:function(){return i}});var x=_("./src/io/loader.js"),h=_("./src/demux/demux-errors.js"),o={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},i={NETWORK_EXCEPTION:x.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:x.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:x.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:x.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:h.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:h.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:h.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(O,v,_){_.r(v);var x={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};v.default=x},"./src/remux/aac-silent.js":function(O,v,_){_.r(v);var x=function(){function h(){}return h.getSilentFrame=function(o,i){if(o==="mp4a.40.2"){if(i===1)return new Uint8Array([0,200,0,128,35,128]);if(i===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(i===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(i===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(i===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(i===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(i===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(i===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(i===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},h}();v.default=x},"./src/remux/mp4-generator.js":function(O,v,_){_.r(v);var x=function(){function h(){}return h.init=function(){h.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var o in h.types)h.types.hasOwnProperty(o)&&(h.types[o]=[o.charCodeAt(0),o.charCodeAt(1),o.charCodeAt(2),o.charCodeAt(3)]);var i=h.constants={};i.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),i.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),i.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSC=i.STCO=i.STTS,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),i.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},h.box=function(o){for(var i=8,d=null,r=Array.prototype.slice.call(arguments,1),l=r.length,u=0;u<l;u++)i+=r[u].byteLength;d=new Uint8Array(i),d[0]=i>>>24&255,d[1]=i>>>16&255,d[2]=i>>>8&255,d[3]=i&255,d.set(o,4);for(var n=8,u=0;u<l;u++)d.set(r[u],n),n+=r[u].byteLength;return d},h.generateInitSegment=function(o){var i=h.box(h.types.ftyp,h.constants.FTYP),d=h.moov(o),r=new Uint8Array(i.byteLength+d.byteLength);return r.set(i,0),r.set(d,i.byteLength),r},h.moov=function(o){var i=h.mvhd(o.timescale,o.duration),d=h.trak(o),r=h.mvex(o);return h.box(h.types.moov,i,d,r)},h.mvhd=function(o,i){return h.box(h.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},h.trak=function(o){return h.box(h.types.trak,h.tkhd(o),h.mdia(o))},h.tkhd=function(o){var i=o.id,d=o.duration,r=o.presentWidth,l=o.presentHeight;return h.box(h.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255,0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,r&255,0,0,l>>>8&255,l&255,0,0]))},h.mdia=function(o){return h.box(h.types.mdia,h.mdhd(o),h.hdlr(o),h.minf(o))},h.mdhd=function(o){var i=o.timescale,d=o.duration;return h.box(h.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,85,196,0,0]))},h.hdlr=function(o){var i=null;return o.type==="audio"?i=h.constants.HDLR_AUDIO:i=h.constants.HDLR_VIDEO,h.box(h.types.hdlr,i)},h.minf=function(o){var i=null;return o.type==="audio"?i=h.box(h.types.smhd,h.constants.SMHD):i=h.box(h.types.vmhd,h.constants.VMHD),h.box(h.types.minf,i,h.dinf(),h.stbl(o))},h.dinf=function(){var o=h.box(h.types.dinf,h.box(h.types.dref,h.constants.DREF));return o},h.stbl=function(o){var i=h.box(h.types.stbl,h.stsd(o),h.box(h.types.stts,h.constants.STTS),h.box(h.types.stsc,h.constants.STSC),h.box(h.types.stsz,h.constants.STSZ),h.box(h.types.stco,h.constants.STCO));return i},h.stsd=function(o){return o.type==="audio"?o.codec==="mp3"?h.box(h.types.stsd,h.constants.STSD_PREFIX,h.mp3(o)):h.box(h.types.stsd,h.constants.STSD_PREFIX,h.mp4a(o)):h.box(h.types.stsd,h.constants.STSD_PREFIX,h.avc1(o))},h.mp3=function(o){var i=o.channelCount,d=o.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,d>>>8&255,d&255,0,0]);return h.box(h.types[".mp3"],r)},h.mp4a=function(o){var i=o.channelCount,d=o.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,d>>>8&255,d&255,0,0]);return h.box(h.types.mp4a,r,h.esds(o))},h.esds=function(o){var i=o.config||[],d=i.length,r=new Uint8Array([0,0,0,0,3,23+d,0,1,0,4,15+d,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([d]).concat(i).concat([6,1,2]));return h.box(h.types.esds,r)},h.avc1=function(o){var i=o.avcc,d=o.codecWidth,r=o.codecHeight,l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>>8&255,d&255,r>>>8&255,r&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return h.box(h.types.avc1,l,h.box(h.types.avcC,i))},h.mvex=function(o){return h.box(h.types.mvex,h.trex(o))},h.trex=function(o){var i=o.id,d=new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return h.box(h.types.trex,d)},h.moof=function(o,i){return h.box(h.types.moof,h.mfhd(o.sequenceNumber),h.traf(o,i))},h.mfhd=function(o){var i=new Uint8Array([0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255]);return h.box(h.types.mfhd,i)},h.traf=function(o,i){var d=o.id,r=h.box(h.types.tfhd,new Uint8Array([0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255])),l=h.box(h.types.tfdt,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255])),u=h.sdtp(o),n=h.trun(o,u.byteLength+16+16+8+16+8+8);return h.box(h.types.traf,r,l,n,u)},h.sdtp=function(o){for(var i=o.samples||[],d=i.length,r=new Uint8Array(4+d),l=0;l<d;l++){var u=i[l].flags;r[l+4]=u.isLeading<<6|u.dependsOn<<4|u.isDependedOn<<2|u.hasRedundancy}return h.box(h.types.sdtp,r)},h.trun=function(o,i){var d=o.samples||[],r=d.length,l=12+16*r,u=new Uint8Array(l);i+=8+l,u.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255],0);for(var n=0;n<r;n++){var t=d[n].duration,a=d[n].size,s=d[n].flags,e=d[n].cts;u.set([t>>>24&255,t>>>16&255,t>>>8&255,t&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.isNonSync,0,0,e>>>24&255,e>>>16&255,e>>>8&255,e&255],12+16*n)}return h.box(h.types.trun,u)},h.mdat=function(o){return h.box(h.types.mdat,o)},h}();x.init(),v.default=x},"./src/remux/mp4-remuxer.js":function(O,v,_){_.r(v);var x=_("./src/utils/logger.js"),h=_("./src/remux/mp4-generator.js"),o=_("./src/remux/aac-silent.js"),i=_("./src/utils/browser.js"),d=_("./src/core/media-segment-info.js"),r=_("./src/utils/exception.js"),l=function(){function u(n){this.TAG="MP4Remuxer",this._config=n,this._isLive=n.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new d.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new d.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(i.default.chrome&&(i.default.version.major<50||i.default.version.major===50&&i.default.version.build<2661)),this._fillSilentAfterSeek=i.default.msedge||i.default.msie,this._mp3UseMpegAudio=!i.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return u.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},u.prototype.bindDataSource=function(n){return n.onDataAvailable=this.remux.bind(this),n.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(u.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(n){this._onInitSegment=n},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(n){this._onMediaSegment=n},enumerable:!1,configurable:!0}),u.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},u.prototype.seek=function(n){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},u.prototype.remux=function(n,t){if(!this._onMediaSegment)throw new r.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(n,t),this._remuxVideo(t),this._remuxAudio(n)},u.prototype._onTrackMetadataReceived=function(n,t){var a=null,s="mp4",e=t.codec;if(n==="audio")this._audioMeta=t,t.codec==="mp3"&&this._mp3UseMpegAudio?(s="mpeg",e="",a=new Uint8Array):a=h.default.generateInitSegment(t);else if(n==="video")this._videoMeta=t,a=h.default.generateInitSegment(t);else return;if(!this._onInitSegment)throw new r.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(n,{type:n,data:a.buffer,codec:e,container:n+"/"+s,mediaDuration:t.duration})},u.prototype._calculateDtsBase=function(n,t){this._dtsBaseInited||(n.samples&&n.samples.length&&(this._audioDtsBase=n.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},u.prototype.flushStashedSamples=function(){var n=this._videoStashedLastSample,t=this._audioStashedLastSample,a={type:"video",id:1,sequenceNumber:0,samples:[],length:0};n!=null&&(a.samples.push(n),a.length=n.length);var s={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};t!=null&&(s.samples.push(t),s.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(a,!0),this._remuxAudio(s,!0)},u.prototype._remuxAudio=function(n,t){if(this._audioMeta!=null){var a=n,s=a.samples,e=void 0,f=-1,c=-1,p=this._audioMeta.refSampleDuration,E=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,L=this._dtsBaseInited&&this._audioNextDts===void 0,S=!1;if(!(!s||s.length===0)&&!(s.length===1&&!t)){var m=0,y=null,A=0;E?(m=0,A=a.length):(m=8,A=8+a.length);var T=null;if(s.length>1&&(T=s.pop(),A-=T.length),this._audioStashedLastSample!=null){var C=this._audioStashedLastSample;this._audioStashedLastSample=null,s.unshift(C),A+=C.length}T!=null&&(this._audioStashedLastSample=T);var M=s[0].dts-this._dtsBase;if(this._audioNextDts)e=M-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())e=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(S=!0);else{var K=this._audioSegmentInfoList.getLastSampleBefore(M);if(K!=null){var V=M-(K.originalDts+K.duration);V<=3&&(V=0);var N=K.dts+K.duration+V;e=M-N}else e=0}if(S){var z=M-e,Q=this._videoSegmentInfoList.getLastSegmentBefore(M);if(Q!=null&&Q.beginDts<z){var j=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(j){var $=Q.beginDts,fe=z-Q.beginDts;x.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+$+", duration: "+fe),s.unshift({unit:j,dts:$,pts:$}),A+=j.byteLength}}else S=!1}for(var X=[],Z=0;Z<s.length;Z++){var C=s[Z],le=C.unit,re=C.dts-this._dtsBase,$=re,oe=!1,pe=null,J=0;if(!(re<-.001)){if(this._audioMeta.codec!=="mp3"){var U=re,ae=3;if(this._audioNextDts&&(U=this._audioNextDts),e=re-U,e<=-ae*p){x.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+re+" ms ,curRefDts: "+U+" ms)  due to dtsCorrection: "+e+" ms overlap.");continue}else if(e>=ae*p&&this._fillAudioTimestampGap&&!i.default.safari){oe=!0;var he=Math.floor(e/p);x.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+re+" ms, curRefDts: "+U+" ms, ")+("dtsCorrection: "+Math.round(e)+" ms, generate: "+he+" frames")),$=Math.floor(U),J=Math.floor(U+p)-$;var j=o.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);j==null&&(x.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),j=le),pe=[];for(var Ee=0;Ee<he;Ee++){U=U+p;var me=Math.floor(U),ge=Math.floor(U+p)-me,Se={dts:me,pts:me,cts:0,unit:j,size:j.byteLength,duration:ge,originalDts:re,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};pe.push(Se),A+=Se.size}this._audioNextDts=U+p}else $=Math.floor(U),J=Math.floor(U+p)-$,this._audioNextDts=U+p}else{if($=re-e,Z!==s.length-1){var Le=s[Z+1].dts-this._dtsBase-e;J=Le-$}else if(T!=null){var Le=T.dts-this._dtsBase-e;J=Le-$}else X.length>=1?J=X[X.length-1].duration:J=Math.floor(p);this._audioNextDts=$+J}f===-1&&(f=$),X.push({dts:$,pts:$,cts:0,unit:C.unit,size:C.unit.byteLength,duration:J,originalDts:re,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),oe&&X.push.apply(X,pe)}}if(X.length===0){a.samples=[],a.length=0;return}E?y=new Uint8Array(A):(y=new Uint8Array(A),y[0]=A>>>24&255,y[1]=A>>>16&255,y[2]=A>>>8&255,y[3]=A&255,y.set(h.default.types.mdat,4));for(var Z=0;Z<X.length;Z++){var le=X[Z].unit;y.set(le,m),m+=le.byteLength}var ce=X[X.length-1];c=ce.dts+ce.duration;var ue=new d.MediaSegmentInfo;ue.beginDts=f,ue.endDts=c,ue.beginPts=f,ue.endPts=c,ue.originalBeginDts=X[0].originalDts,ue.originalEndDts=ce.originalDts+ce.duration,ue.firstSample=new d.SampleInfo(X[0].dts,X[0].pts,X[0].duration,X[0].originalDts,!1),ue.lastSample=new d.SampleInfo(ce.dts,ce.pts,ce.duration,ce.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(ue),a.samples=X,a.sequenceNumber++;var Re=null;E?Re=new Uint8Array:Re=h.default.moof(a,f),a.samples=[],a.length=0;var Te={type:"audio",data:this._mergeBoxes(Re,y).buffer,sampleCount:X.length,info:ue};E&&L&&(Te.timestampOffset=f),this._onMediaSegment("audio",Te)}}},u.prototype._remuxVideo=function(n,t){if(this._videoMeta!=null){var a=n,s=a.samples,e=void 0,f=-1,c=-1,p=-1,E=-1;if(!(!s||s.length===0)&&!(s.length===1&&!t)){var L=8,S=null,m=8+n.length,y=null;if(s.length>1&&(y=s.pop(),m-=y.length),this._videoStashedLastSample!=null){var A=this._videoStashedLastSample;this._videoStashedLastSample=null,s.unshift(A),m+=A.length}y!=null&&(this._videoStashedLastSample=y);var T=s[0].dts-this._dtsBase;if(this._videoNextDts)e=T-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())e=0;else{var C=this._videoSegmentInfoList.getLastSampleBefore(T);if(C!=null){var M=T-(C.originalDts+C.duration);M<=3&&(M=0);var K=C.dts+C.duration+M;e=T-K}else e=0}for(var V=new d.MediaSegmentInfo,N=[],z=0;z<s.length;z++){var A=s[z],Q=A.dts-this._dtsBase,j=A.isKeyframe,$=Q-e,fe=A.cts,X=$+fe;f===-1&&(f=$,p=X);var Z=0;if(z!==s.length-1){var le=s[z+1].dts-this._dtsBase-e;Z=le-$}else if(y!=null){var le=y.dts-this._dtsBase-e;Z=le-$}else N.length>=1?Z=N[N.length-1].duration:Z=Math.floor(this._videoMeta.refSampleDuration);if(j){var re=new d.SampleInfo($,X,Z,A.dts,!0);re.fileposition=A.fileposition,V.appendSyncPoint(re)}N.push({dts:$,pts:X,cts:fe,units:A.units,size:A.length,isKeyframe:j,duration:Z,originalDts:Q,flags:{isLeading:0,dependsOn:j?2:1,isDependedOn:j?1:0,hasRedundancy:0,isNonSync:j?0:1}})}S=new Uint8Array(m),S[0]=m>>>24&255,S[1]=m>>>16&255,S[2]=m>>>8&255,S[3]=m&255,S.set(h.default.types.mdat,4);for(var z=0;z<N.length;z++)for(var oe=N[z].units;oe.length;){var pe=oe.shift(),J=pe.data;S.set(J,L),L+=J.byteLength}var U=N[N.length-1];if(c=U.dts+U.duration,E=U.pts+U.duration,this._videoNextDts=c,V.beginDts=f,V.endDts=c,V.beginPts=p,V.endPts=E,V.originalBeginDts=N[0].originalDts,V.originalEndDts=U.originalDts+U.duration,V.firstSample=new d.SampleInfo(N[0].dts,N[0].pts,N[0].duration,N[0].originalDts,N[0].isKeyframe),V.lastSample=new d.SampleInfo(U.dts,U.pts,U.duration,U.originalDts,U.isKeyframe),this._isLive||this._videoSegmentInfoList.append(V),a.samples=N,a.sequenceNumber++,this._forceFirstIDR){var ae=N[0].flags;ae.dependsOn=2,ae.isNonSync=0}var he=h.default.moof(a,f);a.samples=[],a.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(he,S).buffer,sampleCount:N.length,info:V})}}},u.prototype._mergeBoxes=function(n,t){var a=new Uint8Array(n.byteLength+t.byteLength);return a.set(n,0),a.set(t,n.byteLength),a},u}();v.default=l},"./src/utils/browser.js":function(O,v,_){_.r(v);var x={};function h(){var o=self.navigator.userAgent.toLowerCase(),i=/(edge)\/([\w.]+)/.exec(o)||/(opr)[\/]([\w.]+)/.exec(o)||/(chrome)[ \/]([\w.]+)/.exec(o)||/(iemobile)[\/]([\w.]+)/.exec(o)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(o)||/(webkit)[ \/]([\w.]+)/.exec(o)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(o)||/(msie) ([\w.]+)/.exec(o)||o.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(o)||o.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(o)||[],d=/(ipad)/.exec(o)||/(ipod)/.exec(o)||/(windows phone)/.exec(o)||/(iphone)/.exec(o)||/(kindle)/.exec(o)||/(android)/.exec(o)||/(windows)/.exec(o)||/(mac)/.exec(o)||/(linux)/.exec(o)||/(cros)/.exec(o)||[],r={browser:i[5]||i[3]||i[1]||"",version:i[2]||i[4]||"0",majorVersion:i[4]||i[2]||"0",platform:d[0]||""},l={};if(r.browser){l[r.browser]=!0;var u=r.majorVersion.split(".");l.version={major:parseInt(r.majorVersion,10),string:r.version},u.length>1&&(l.version.minor=parseInt(u[1],10)),u.length>2&&(l.version.build=parseInt(u[2],10))}if(r.platform&&(l[r.platform]=!0),(l.chrome||l.opr||l.safari)&&(l.webkit=!0),l.rv||l.iemobile){l.rv&&delete l.rv;var n="msie";r.browser=n,l[n]=!0}if(l.edge){delete l.edge;var t="msedge";r.browser=t,l[t]=!0}if(l.opr){var a="opera";r.browser=a,l[a]=!0}if(l.safari&&l.android){var s="android";r.browser=s,l[s]=!0}l.name=r.browser,l.platform=r.platform;for(var e in x)x.hasOwnProperty(e)&&delete x[e];Object.assign(x,l)}h(),v.default=x},"./src/utils/exception.js":function(O,v,_){_.r(v),_.d(v,{RuntimeException:function(){return h},IllegalStateException:function(){return o},InvalidArgumentException:function(){return i},NotImplementedException:function(){return d}});var x=function(){var r=function(l,u){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])},r(l,u)};return function(l,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");r(l,u);function n(){this.constructor=l}l.prototype=u===null?Object.create(u):(n.prototype=u.prototype,new n)}}(),h=function(){function r(l){this._message=l}return Object.defineProperty(r.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return this.name+": "+this.message},r}(),o=function(r){x(l,r);function l(u){return r.call(this,u)||this}return Object.defineProperty(l.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),l}(h),i=function(r){x(l,r);function l(u){return r.call(this,u)||this}return Object.defineProperty(l.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),l}(h),d=function(r){x(l,r);function l(u){return r.call(this,u)||this}return Object.defineProperty(l.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),l}(h)},"./src/utils/logger.js":function(O,v,_){_.r(v);var x=_("./node_modules/events/events.js"),h=_.n(x),o=function(){function i(){}return i.e=function(d,r){(!d||i.FORCE_GLOBAL_TAG)&&(d=i.GLOBAL_TAG);var l="["+d+"] > "+r;i.ENABLE_CALLBACK&&i.emitter.emit("log","error",l),i.ENABLE_ERROR&&(console.error?console.error(l):console.warn?console.warn(l):console.log(l))},i.i=function(d,r){(!d||i.FORCE_GLOBAL_TAG)&&(d=i.GLOBAL_TAG);var l="["+d+"] > "+r;i.ENABLE_CALLBACK&&i.emitter.emit("log","info",l),i.ENABLE_INFO&&(console.info?console.info(l):console.log(l))},i.w=function(d,r){(!d||i.FORCE_GLOBAL_TAG)&&(d=i.GLOBAL_TAG);var l="["+d+"] > "+r;i.ENABLE_CALLBACK&&i.emitter.emit("log","warn",l),i.ENABLE_WARN&&(console.warn?console.warn(l):console.log(l))},i.d=function(d,r){(!d||i.FORCE_GLOBAL_TAG)&&(d=i.GLOBAL_TAG);var l="["+d+"] > "+r;i.ENABLE_CALLBACK&&i.emitter.emit("log","debug",l),i.ENABLE_DEBUG&&(console.debug?console.debug(l):console.log(l))},i.v=function(d,r){(!d||i.FORCE_GLOBAL_TAG)&&(d=i.GLOBAL_TAG);var l="["+d+"] > "+r;i.ENABLE_CALLBACK&&i.emitter.emit("log","verbose",l),i.ENABLE_VERBOSE&&console.log(l)},i}();o.GLOBAL_TAG="flv.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new(h()),v.default=o},"./src/utils/logging-control.js":function(O,v,_){_.r(v);var x=_("./node_modules/events/events.js"),h=_.n(x),o=_("./src/utils/logger.js"),i=function(){function d(){}return Object.defineProperty(d,"forceGlobalTag",{get:function(){return o.default.FORCE_GLOBAL_TAG},set:function(r){o.default.FORCE_GLOBAL_TAG=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"globalTag",{get:function(){return o.default.GLOBAL_TAG},set:function(r){o.default.GLOBAL_TAG=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableAll",{get:function(){return o.default.ENABLE_VERBOSE&&o.default.ENABLE_DEBUG&&o.default.ENABLE_INFO&&o.default.ENABLE_WARN&&o.default.ENABLE_ERROR},set:function(r){o.default.ENABLE_VERBOSE=r,o.default.ENABLE_DEBUG=r,o.default.ENABLE_INFO=r,o.default.ENABLE_WARN=r,o.default.ENABLE_ERROR=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableDebug",{get:function(){return o.default.ENABLE_DEBUG},set:function(r){o.default.ENABLE_DEBUG=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableVerbose",{get:function(){return o.default.ENABLE_VERBOSE},set:function(r){o.default.ENABLE_VERBOSE=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableInfo",{get:function(){return o.default.ENABLE_INFO},set:function(r){o.default.ENABLE_INFO=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableWarn",{get:function(){return o.default.ENABLE_WARN},set:function(r){o.default.ENABLE_WARN=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableError",{get:function(){return o.default.ENABLE_ERROR},set:function(r){o.default.ENABLE_ERROR=r,d._notifyChange()},enumerable:!1,configurable:!0}),d.getConfig=function(){return{globalTag:o.default.GLOBAL_TAG,forceGlobalTag:o.default.FORCE_GLOBAL_TAG,enableVerbose:o.default.ENABLE_VERBOSE,enableDebug:o.default.ENABLE_DEBUG,enableInfo:o.default.ENABLE_INFO,enableWarn:o.default.ENABLE_WARN,enableError:o.default.ENABLE_ERROR,enableCallback:o.default.ENABLE_CALLBACK}},d.applyConfig=function(r){o.default.GLOBAL_TAG=r.globalTag,o.default.FORCE_GLOBAL_TAG=r.forceGlobalTag,o.default.ENABLE_VERBOSE=r.enableVerbose,o.default.ENABLE_DEBUG=r.enableDebug,o.default.ENABLE_INFO=r.enableInfo,o.default.ENABLE_WARN=r.enableWarn,o.default.ENABLE_ERROR=r.enableError,o.default.ENABLE_CALLBACK=r.enableCallback},d._notifyChange=function(){var r=d.emitter;if(r.listenerCount("change")>0){var l=d.getConfig();r.emit("change",l)}},d.registerListener=function(r){d.emitter.addListener("change",r)},d.removeListener=function(r){d.emitter.removeListener("change",r)},d.addLogListener=function(r){o.default.emitter.addListener("log",r),o.default.emitter.listenerCount("log")>0&&(o.default.ENABLE_CALLBACK=!0,d._notifyChange())},d.removeLogListener=function(r){o.default.emitter.removeListener("log",r),o.default.emitter.listenerCount("log")===0&&(o.default.ENABLE_CALLBACK=!1,d._notifyChange())},d}();i.emitter=new(h()),v.default=i},"./src/utils/polyfill.js":function(O,v,_){_.r(v);var x=function(){function h(){}return h.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(o,i){return o.__proto__=i,o},Object.assign=Object.assign||function(o){if(o==null)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(o),d=1;d<arguments.length;d++){var r=arguments[d];if(r!=null)for(var l in r)r.hasOwnProperty(l)&&(i[l]=r[l])}return i},typeof self.Promise!="function"&&_("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},h}();x.install(),v.default=x},"./src/utils/utf8-conv.js":function(O,v,_){_.r(v);function x(o,i,d){var r=o;if(i+d<r.length){for(;d--;)if((r[++i]&192)!==128)return!1;return!0}else return!1}function h(o){for(var i=[],d=o,r=0,l=o.length;r<l;){if(d[r]<128){i.push(String.fromCharCode(d[r])),++r;continue}else if(!(d[r]<192)){if(d[r]<224){if(x(d,r,1)){var u=(d[r]&31)<<6|d[r+1]&63;if(u>=128){i.push(String.fromCharCode(u&65535)),r+=2;continue}}}else if(d[r]<240){if(x(d,r,2)){var u=(d[r]&15)<<12|(d[r+1]&63)<<6|d[r+2]&63;if(u>=2048&&(u&63488)!==55296){i.push(String.fromCharCode(u&65535)),r+=3;continue}}}else if(d[r]<248&&x(d,r,3)){var u=(d[r]&7)<<18|(d[r+1]&63)<<12|(d[r+2]&63)<<6|d[r+3]&63;if(u>65536&&u<1114112){u-=65536,i.push(String.fromCharCode(u>>>10|55296)),i.push(String.fromCharCode(u&1023|56320)),r+=4;continue}}}i.push(String.fromCharCode(65533)),++r}return i.join("")}v.default=h}},F={};function P(O){var v=F[O];if(v!==void 0)return v.exports;var _=F[O]={exports:{}};return D[O].call(_.exports,_,_.exports,P),_.exports}P.m=D,function(){P.n=function(O){var v=O&&O.__esModule?function(){return O.default}:function(){return O};return P.d(v,{a:v}),v}}(),function(){P.d=function(O,v){for(var _ in v)P.o(v,_)&&!P.o(O,_)&&Object.defineProperty(O,_,{enumerable:!0,get:v[_]})}}(),function(){P.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){P.o=function(O,v){return Object.prototype.hasOwnProperty.call(O,v)}}(),function(){P.r=function(O){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})}}();var k=P("./src/index.js");return k}()})})(ft);const Kr=Ot(ft.exports),Vr=()=>{const g=Dt(),R=rt(),D=xe(),F=Ct(),P=xe(0),k=we({});return{route:g,router:R,videoRef:D,userStore:F,roomID:P,liveInfo:k}},Hr=(g,R,D,F,P)=>{let k;return(()=>{const v=()=>{console.log("websocket \u8FDE\u63A5\u6210\u529F ")},_=()=>{console.error("websocket \u8FDE\u63A5\u5931\u8D25 ")},x=async h=>{console.log(h.data);const o=new FileReader;o.readAsArrayBuffer(h.data),o.onload=function(i){let d=new Uint8Array(o.result);const r=or(d);switch(r.msgType){case"error":jr(r);break;case"webClientBarrageRes":Nr(r,g,D);break;case"webClientEnterLiveRoomRes":Wr(r,g,D);break;case"webClientHistoricalBarrageRes":Gr(r,g,D);break;default:console.error("\u672A\u652F\u6301\u7684\u6D88\u606F\u7C7B\u578B");break}console.log(r)}};if(typeof WebSocket>"u"){ke.fire({title:"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301socket",heightAuto:!1,confirmButtonColor:Ue.colorButtonTheme,icon:"error"}),P.back();return}else k=new WebSocket("ws://www.haifengonline.top:8081/ws/liveSocket?token="+R.userInfoData.token+"&liveRoom="+F.value),k.onopen=v,k.onerror=_,k.onmessage=x})(),{sendMessage:v=>{console.log("\u53D1\u9001\u6D88\u606F",v),k.send(v)}}},zr=async(g,R,D,F,P)=>{var k,O,v,_;try{if(!R.params.id){D.back(),ke.fire({title:"\u8BBF\u95EE\u623F\u95F4\u5931\u8D25",heightAuto:!1,confirmButtonColor:Ue.colorButtonTheme,icon:"error"}),D.back();return}F.value=Number(R.params.id);const x=await Ft({room_id:F.value});if(!x.data){ke.fire({title:"\u8BE5\u7528\u6237\u672A\u8FDB\u884C\u76F4\u64AD\u914D\u7F6E",heightAuto:!1,confirmButtonColor:Ue.colorButtonTheme,icon:"error"});return}return P.live_title=(k=x.data)==null?void 0:k.live_title,P.photo=(O=x.data)==null?void 0:O.photo,P.username=(v=x.data)==null?void 0:v.username,P.flv=(_=x.data)==null?void 0:_.flv,console.log(g),new Bt({container:g.value,loop:!0,lang:"zh-cn",logo:"",autoplay:!0,danmaku:!0,apiBackend:{read:function(o){console.log("Pretend to connect WebSocket"),o.success([])},send:function(o){console.log("Pretend to send danmaku via WebSocket",o.data),o.success()}},mutex:!1,video:{type:"customFlv",url:P.flv,customType:{customFlv:(o,i)=>{const d=Kr.createPlayer({type:"flv",isLive:!0,hasAudio:!0,url:P.flv});Tt(()=>{d.attachMediaElement(o),d.load()})}}}})}catch(x){console.log(x)}},$r=g=>(Xe("data-v-1bb974a7"),g=g(),Qe(),g),Yr={class:"overall"},Xr={class:"head animate__animated animate__slideInDown"},Qr={class:"common-row"},Zr={class:"live-box"},Jr={class:"content"},qr={class:"content-row"},en=$r(()=>W("h3",null,"Ta \u7684\u4E13\u680F",-1)),tn={class:"dynamic-box"},rn={class:"dynamic"},nn=Ne({__name:"room",setup(g){const R=xe();var D;const{videoRef:F,userStore:P,route:k,router:O,roomID:v,liveInfo:_}=Vr(),x=xe(h=>{});return Ye(async()=>{D=await zr(F,k,O,v,_),x.value=Hr(D,P,R,v,O).sendMessage}),(h,o)=>{const i=It,d=wt;return ie(),se("div",Yr,[W("div",Xr,[W("div",Qr,[Y(d,{gutter:20},{default:ve(()=>[Y(i,{span:18},{default:ve(()=>{var r,l,u,n;return[W("div",Zr,[Y(nr,{src:(r=ee(_))!=null&&r.photo?(l=ee(_))==null?void 0:l.photo:"",titel:(u=ee(_))!=null&&u.live_title?(n=ee(_))==null?void 0:n.live_title:""},null,8,["src","titel"]),W("div",{ref_key:"videoRef",ref:F,class:"player",id:"dplay"},null,512)])]}),_:1}),Y(i,{span:6},{default:ve(()=>[Y(Ur,{ref_key:"sideRef",ref:R,onSendMessage:x.value,userInfo:ee(P).userInfoData},null,8,["onSendMessage","userInfo"])]),_:1})]),_:1})])]),W("div",Jr,[W("div",qr,[en,Y(d,{gutter:20},{default:ve(()=>[Y(i,{span:16},{default:ve(()=>[W("div",tn,[W("div",rn,[Y(Xt,{roomID:Number(ee(k).params.id)},null,8,["roomID"])])])]),_:1})]),_:1})])])])}}});const gn=We(nn,[["__scopeId","data-v-1bb974a7"]]);export{gn as default};
